<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>esp-idf-record | blog of Jungle</title>
  <meta name="keywords" content=" esp-idf ">
  <meta name="description" content="esp-idf-record | blog of Jungle">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="个人介绍Jungle  毕业于CUIT, 目前在sz工作. 喜欢学习新技术 成为一个合格的程序员, 一定要学好三样东西: 数学 编程 算法 情商 财商     最近什么的干活 面经 + 算法题hot100  提升自我  基础：  集合、反射 JVM linux命令及脚本编程 mysql 、redis、mq 基础知识点及原理   进阶：  多线程高并发【并发编程的艺术】 SSM ：Spring cl">
<meta property="og:type" content="website">
<meta property="og:title" content="个人简介">
<meta property="og:url" content="http://example.com/about/index.html">
<meta property="og:site_name" content="blog of Jungle">
<meta property="og:description" content="个人介绍Jungle  毕业于CUIT, 目前在sz工作. 喜欢学习新技术 成为一个合格的程序员, 一定要学好三样东西: 数学 编程 算法 情商 财商     最近什么的干活 面经 + 算法题hot100  提升自我  基础：  集合、反射 JVM linux命令及脚本编程 mysql 、redis、mq 基础知识点及原理   进阶：  多线程高并发【并发编程的艺术】 SSM ：Spring cl">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2020-11-13T11:42:01.000Z">
<meta property="article:modified_time" content="2023-09-14T17:15:02.611Z">
<meta property="article:author" content="Jungle">
<meta name="twitter:card" content="summary">


<link rel="icon" href="/img/avatar.jpg">

<link href="/css/style.css?v=1.1.0" rel="stylesheet">

<link href="/css/hl_theme/atom-light.css?v=1.1.0" rel="stylesheet">

<link href="//cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" rel="stylesheet">

<script src="//cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="/js/titleTip.js?v=1.1.0" ></script>

<script src="//cdn.jsdelivr.net/npm/highlightjs@9.16.2/highlight.pack.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script>



<script src="//cdn.jsdelivr.net/npm/jquery.cookie@1.4.1/jquery.cookie.min.js" ></script>

<script src="/js/iconfont.js?v=1.1.0" ></script>

<meta name="generator" content="Hexo 5.2.0"></head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="">
  <input class="theme_blog_path" value="">
  <input id="theme_shortcut" value="true" />
  <input id="theme_highlight_on" value="true" />
  <input id="theme_code_copy" value="true" />
</div>



<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/" class="avatar_target">
    <img class="avatar" src="/img/avatar.jpg" />
</a>
<div class="author">
    <span>Jungle</span>
</div>

<div class="icon">
    
        
        <a title="rss" href="/atom.xml" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-rss"></use>
                </svg>
            
        </a>
        
    
        
        <a title="github" href="https://github.com/jungle8884" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-github"></use>
                </svg>
            
        </a>
        
    
        
        <a title="csdn" href="https://blog.csdn.net/jungle8884" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-csdn"></use>
                </svg>
            
        </a>
        
    
        
    
        
        <a title="email" href="mailto:jungle8884@163.com" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-email"></use>
                </svg>
            
        </a>
        
    
        
        <a title="qq" href="http://wpa.qq.com/msgrd?v=3&uin=983123369&site=qq&menu=yes" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-qq"></use>
                </svg>
            
        </a>
        
    
        
        <a title="neteasemusic" href="https://music.163.com/#/user/home?id=88786971" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-neteasemusic"></use>
                </svg>
            
        </a>
        
    
</div>




<ul>
    <li><div class="all active" data-rel="全部文章">全部文章<small>(90)</small></div></li>
    
        
            
            <li><div data-rel="工具"><i class="fold iconfont icon-right"></i>工具<small>(11)</small></div>
                
                    <ul class="sub hide">
                        
                        <li><div data-rel="工具<--->插件">插件<small>(2)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="工具<--->audio">audio<small>(1)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="工具<--->ChatGPT">ChatGPT<small>(1)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="工具<--->git">git<small>(3)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="工具<--->github">github<small>(1)</small></div>
                            
                        </li>
                            
                    </ul>
                
            </li>
            
        
    
        
            
            <li><div data-rel="后端"><i class="fold iconfont icon-right"></i>后端<small>(23)</small></div>
                
                    <ul class="sub hide">
                        
                        <li><div data-rel="后端<--->设计模式">设计模式<small>(8)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="后端<--->C#">C#<small>(2)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="后端<--->Java">Java<small>(11)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="后端<--->SpringBoot">SpringBoot<small>(1)</small></div>
                            
                        </li>
                            
                    </ul>
                
            </li>
            
        
    
        
            
            <li><div data-rel="数据库"><i class="fold iconfont icon-right"></i>数据库<small>(2)</small></div>
                
                    <ul class="sub hide">
                        
                        <li><div data-rel="数据库<--->MySQL">MySQL<small>(1)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="数据库<--->Redis">Redis<small>(1)</small></div>
                            
                        </li>
                            
                    </ul>
                
            </li>
            
        
    
        
            
        
    
        
            
            <li><div data-rel="沉淀一下">沉淀一下<small>(1)</small></div>
                
            </li>
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
            <li><div data-rel="前端">前端<small>(1)</small></div>
                
            </li>
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
            <li><div data-rel="算法"><i class="fold iconfont icon-right"></i>算法<small>(17)</small></div>
                
                    <ul class="sub hide">
                        
                        <li><div data-rel="算法<--->滑动窗口">滑动窗口<small>(1)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="算法<--->基础">基础<small>(1)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="算法<--->面试题">面试题<small>(1)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="算法<--->日期">日期<small>(2)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="算法<--->树">树<small>(4)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="算法<--->数学">数学<small>(1)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="算法<--->数组">数组<small>(1)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="算法<--->双指针">双指针<small>(1)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="算法<--->图">图<small>(2)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="算法<--->LeetCode">LeetCode<small>(1)</small></div>
                            
                        </li>
                            
                    </ul>
                
            </li>
            
        
    
        
            
        
    
        
            
            <li><div data-rel="物联网"><i class="fold iconfont icon-right"></i>物联网<small>(15)</small></div>
                
                    <ul class="sub hide">
                        
                        <li><div data-rel="物联网<--->乐鑫">乐鑫<small>(2)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="物联网<--->设备端">设备端<small>(7)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="物联网<--->物联网平台">物联网平台<small>(5)</small></div>
                            
                        </li>
                            
                    </ul>
                
            </li>
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
            <li><div data-rel="docker"><i class="fold iconfont icon-right"></i>docker<small>(7)</small></div>
                
                    <ul class="sub hide">
                        
                        <li><div data-rel="docker<--->fastbee">fastbee<small>(1)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="docker<--->ruoyi">ruoyi<small>(2)</small></div>
                            
                        </li>
                            
                    </ul>
                
            </li>
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
            <li><div data-rel="linux"><i class="fold iconfont icon-right"></i>linux<small>(5)</small></div>
                
                    <ul class="sub hide">
                        
                        <li><div data-rel="linux<--->基本使用">基本使用<small>(1)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="linux<--->三剑客">三剑客<small>(1)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="linux<--->shell">shell<small>(1)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="linux<--->wls">wls<small>(1)</small></div>
                            
                        </li>
                            
                    </ul>
                
            </li>
            
        
    
        
            
        
    
        
            
            <li><div data-rel="Python"><i class="fold iconfont icon-right"></i>Python<small>(7)</small></div>
                
                    <ul class="sub hide">
                        
                        <li><div data-rel="Python<--->pytorch">pytorch<small>(1)</small></div>
                            
                        </li>
                            
                    </ul>
                
            </li>
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
</ul>
<div class="left-bottom">
    <div class="menus">
    
    
    
    
    </div>
    <div><a class="about  hasFriend  site_url"  href="/about">关于</a><a style="width: 50%"  class="friends">友链</a></div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="90">
<input type="hidden" id="yelog_site_word_count" value="280.6k">
<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        友情链接
        <i class="iconfont icon-left"></i>
    </div>
    <div class="friends-content">
        <ul>
            
            <li><a target="_blank" href="http://yelog.org/">叶落阁</a></li>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <div class="right-top">
        <div id="default-panel">
            <i class="iconfont icon-search" data-title="搜索 快捷键 i"></i>
            <div class="right-title">全部文章</div>
            <i class="iconfont icon-file-tree" data-title="切换到大纲视图 快捷键 w"></i>
        </div>
        <div id="search-panel">
            <i class="iconfont icon-left" data-title="返回"></i>
            <input id="local-search-input" />
            <label class="border-line" for="input"></label>
            <i class="iconfont icon-case-sensitive" data-title="大小写敏感"></i>
            <i class="iconfont icon-tag" data-title="标签"></i>
        </div>
        <div id="outline-panel" style="display: none">
            <div class="right-title">大纲</div>
            <i class="iconfont icon-list" data-title="切换到文章列表"></i>
        </div>
    </div>

    <div class="tags-list">
    <input id="tag-search" />
    <div class="tag-wrapper">
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>51C</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>博客搭建</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>蔡勒公式</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>策略模式</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>查找</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>抽象工厂模式</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>创建型模式</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>代理模式</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>单例模式</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>迭代器</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>多表查询</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>多态</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>多线程</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>二叉树</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>工厂方法模式</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>构建型模式</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>观察者模式</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>滑动窗口</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>集合</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>简单工厂模式</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>建造者模式</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>结构型模式</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>进制转换</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>镜像</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>开发</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>开发框架</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>快速平方根</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>乐鑫</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>六大原则</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>爬虫</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>排序</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>前端</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>前缀树</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>容器</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>闰年</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>事务</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>数据库的备份和还原</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>数据库的设计</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>数组</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>双指针</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>贪心</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>图</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>委托与事件</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>行为型模式</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>优先队列</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>油猴</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>原码, 反码, 补码, 移码</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>原型模式</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>约束</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Ado.net</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>ArrayList</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>AT</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>audio</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>awk</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>C</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>C#</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>ChatGPT</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>device</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>DL</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>docker</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>docker-desktop</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>ESP Rainmaker</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>esp-idf</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>ESP32</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>ESP32C3</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>fastapi</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>fastbee</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Fastbee</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>FleetBee</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>git</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>github</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>grep</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>http</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>IO</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>iot</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Java</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>JavaScript</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Job</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>k3s</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>LeetCode</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>LinkedList</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>linux</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>List</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Map</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>MircroPython</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>mqtt上传文件</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>N叉树</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>N的阶乘</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>NoSQL</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>OJ</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>pyside</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>python</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Python</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>pytorch</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Resnet</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>sed</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Set</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>shadowsocks</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>shell</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Shell</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>SpringBoot</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>SQL</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>STM32</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Stream</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>tkinter</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Utils</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Vector</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>video</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Vue</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>WebGIS</a>
            </li>
        
    </div>

</div>

    
    <nav id="title-list-nav">
        
        <a id="top" class="全部文章 Python "
           href="/2020/11/24/WordofCS/"
           data-tag="DL"
           data-author="" >
            <span class="post-title" title="WordofCS">WordofCS</span>
            <span class="post-date" title="2020-11-24 17:21:02">2020/11/24</span>
        </a>
        
        <a  class="全部文章 docker "
           href="/2025/10/11/docker-destop/"
           data-tag="docker-desktop"
           data-author="" >
            <span class="post-title" title="docker_destop">docker_destop</span>
            <span class="post-date" title="2025-10-11 09:52:56">2025/10/11</span>
        </a>
        
        <a  class="全部文章 后端 "
           href="/2025/10/10/java-mark/"
           data-tag="Java"
           data-author="" >
            <span class="post-title" title="java要点小结">java要点小结</span>
            <span class="post-date" title="2025-10-10 17:28:57">2025/10/10</span>
        </a>
        
        <a  class="全部文章 Python "
           href="/2025/09/29/pysideRecord/"
           data-tag="pyside"
           data-author="" >
            <span class="post-title" title="pysideRecord">pysideRecord</span>
            <span class="post-date" title="2025-09-29 20:46:51">2025/09/29</span>
        </a>
        
        <a  class="全部文章 docker fastbee "
           href="/2025/09/19/dockerDeploy/"
           data-tag="iot"
           data-author="" >
            <span class="post-title" title="fastbee项目部署">fastbee项目部署</span>
            <span class="post-date" title="2025-09-19 10:22:51">2025/09/19</span>
        </a>
        
        <a  class="全部文章 Python "
           href="/2025/09/18/fastapiLearning/"
           data-tag="fastapi"
           data-author="" >
            <span class="post-title" title="fastapiNote">fastapiNote</span>
            <span class="post-date" title="2025-09-18 15:42:57">2025/09/18</span>
        </a>
        
        <a  class="全部文章 linux "
           href="/2025/07/21/Ubuntu/"
           data-tag="shell"
           data-author="" >
            <span class="post-title" title="Linux">Linux</span>
            <span class="post-date" title="2025-07-21 09:57:43">2025/07/21</span>
        </a>
        
        <a  class="全部文章 物联网 "
           href="/2025/03/06/esp32-ubuntun-start/"
           data-tag="乐鑫"
           data-author="" >
            <span class="post-title" title="esp32_ubuntun_start">esp32_ubuntun_start</span>
            <span class="post-date" title="2025-03-06 15:02:56">2025/03/06</span>
        </a>
        
        <a  class="全部文章 "
           href="/2025/01/18/vim-use/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="vim-use">vim-use</span>
            <span class="post-date" title="2025-01-18 09:35:04">2025/01/18</span>
        </a>
        
        <a  class="全部文章 linux shell "
           href="/2025/01/15/shell-programming/"
           data-tag="linux"
           data-author="" >
            <span class="post-title" title="shell_programming">shell_programming</span>
            <span class="post-date" title="2025-01-15 15:40:40">2025/01/15</span>
        </a>
        
        <a  class="全部文章 物联网 乐鑫 "
           href="/2024/12/30/esp-idf-record/"
           data-tag="esp-idf"
           data-author="" >
            <span class="post-title" title="esp-idf-record">esp-idf-record</span>
            <span class="post-date" title="2024-12-30 10:46:49">2024/12/30</span>
        </a>
        
        <a  class="全部文章 物联网 乐鑫 "
           href="/2024/12/27/esp-idf-cmd/"
           data-tag="esp-idf"
           data-author="" >
            <span class="post-title" title="esp-idf-cmd">esp-idf-cmd</span>
            <span class="post-date" title="2024-12-27 16:41:01">2024/12/27</span>
        </a>
        
        <a  class="全部文章 Python "
           href="/2024/09/06/pyGUI/"
           data-tag="tkinter"
           data-author="" >
            <span class="post-title" title="tkinterecord">tkinterecord</span>
            <span class="post-date" title="2024-09-06 14:41:16">2024/09/06</span>
        </a>
        
        <a  class="全部文章 物联网 设备端 "
           href="/2024/08/26/basic-Arduino/"
           data-tag="C"
           data-author="" >
            <span class="post-title" title="basic_Arduino">basic_Arduino</span>
            <span class="post-date" title="2024-08-26 17:47:27">2024/08/26</span>
        </a>
        
        <a  class="全部文章 物联网 物联网平台 "
           href="/2024/08/13/mqtt/"
           data-tag="mqtt上传文件"
           data-author="" >
            <span class="post-title" title="MQTT">MQTT</span>
            <span class="post-date" title="2024-08-13 15:45:34">2024/08/13</span>
        </a>
        
        <a  class="全部文章 物联网 设备端 "
           href="/2024/06/07/IntelligenLEDStrip/"
           data-tag="ESP Rainmaker"
           data-author="" >
            <span class="post-title" title="智能灯带">智能灯带</span>
            <span class="post-date" title="2024-06-07 10:15:00">2024/06/07</span>
        </a>
        
        <a  class="全部文章 linux wls "
           href="/2024/05/28/linux-note/"
           data-tag="linux"
           data-author="" >
            <span class="post-title" title="linux_note">linux_note</span>
            <span class="post-date" title="2024-05-28 09:22:34">2024/05/28</span>
        </a>
        
        <a  class="全部文章 docker "
           href="/2024/05/14/k3s%E9%83%A8%E7%BD%B2%E6%96%87%E6%A1%A3/"
           data-tag="k3s"
           data-author="" >
            <span class="post-title" title="k3s">k3s</span>
            <span class="post-date" title="2024-05-14 16:36:52">2024/05/14</span>
        </a>
        
        <a  class="全部文章 docker "
           href="/2024/05/14/local_deploy/"
           data-tag="fastbee"
           data-author="" >
            <span class="post-title" title="物联网平台本地部署并接入摄像头">物联网平台本地部署并接入摄像头</span>
            <span class="post-date" title="2024-05-14 16:31:52">2024/05/14</span>
        </a>
        
        <a  class="全部文章 物联网 物联网平台 "
           href="/2024/04/12/CameraAccess/"
           data-tag="FleetBee"
           data-author="" >
            <span class="post-title" title="摄像头接入">摄像头接入</span>
            <span class="post-date" title="2024-04-12 16:48:52">2024/04/12</span>
        </a>
        
        <a  class="全部文章 linux 基本使用 "
           href="/2024/03/31/linux%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/"
           data-tag="linux"
           data-author="" >
            <span class="post-title" title="linux的基本使用">linux的基本使用</span>
            <span class="post-date" title="2024-03-31 17:40:34">2024/03/31</span>
        </a>
        
        <a  class="全部文章 docker ruoyi "
           href="/2024/01/09/ruoyi_2Dev/"
           data-tag="开发框架"
           data-author="" >
            <span class="post-title" title="ruoyi-二次开发">ruoyi-二次开发</span>
            <span class="post-date" title="2024-01-09 11:20:00">2024/01/09</span>
        </a>
        
        <a  class="全部文章 docker ruoyi "
           href="/2024/01/06/ruoyi/"
           data-tag="开发框架"
           data-author="" >
            <span class="post-title" title="ruoyi">ruoyi</span>
            <span class="post-date" title="2024-01-06 15:20:00">2024/01/06</span>
        </a>
        
        <a  class="全部文章 后端 SpringBoot "
           href="/2024/01/05/SpringBoor_Vue/"
           data-tag="SpringBoot,Vue"
           data-author="" >
            <span class="post-title" title="SpringBoot_Vue">SpringBoot_Vue</span>
            <span class="post-date" title="2024-01-05 11:20:01">2024/01/05</span>
        </a>
        
        <a  class="全部文章 物联网 物联网平台 "
           href="/2023/12/27/wumei_DeepIn/"
           data-tag="device"
           data-author="" >
            <span class="post-title" title="wumei-deviceDeepIn">wumei-deviceDeepIn</span>
            <span class="post-date" title="2023-12-27 10:23:00">2023/12/27</span>
        </a>
        
        <a  class="全部文章 物联网 物联网平台 "
           href="/2023/12/26/wumei_deviceInto/"
           data-tag="device"
           data-author="" >
            <span class="post-title" title="wumei-deviceInto">wumei-deviceInto</span>
            <span class="post-date" title="2023-12-26 11:20:00">2023/12/26</span>
        </a>
        
        <a  class="全部文章 物联网 设备端 "
           href="/2023/12/12/ESP32-C3/"
           data-tag="ESP32C3"
           data-author="" >
            <span class="post-title" title="ESP32C3">ESP32C3</span>
            <span class="post-date" title="2023-12-12 15:43:52">2023/12/12</span>
        </a>
        
        <a  class="全部文章 物联网 物联网平台 "
           href="/2023/12/11/wumei/"
           data-tag="Fastbee"
           data-author="" >
            <span class="post-title" title="wumei">wumei</span>
            <span class="post-date" title="2023-12-11 09:48:52">2023/12/11</span>
        </a>
        
        <a  class="全部文章 物联网 设备端 "
           href="/2023/11/08/ESP32/"
           data-tag="MircroPython"
           data-author="" >
            <span class="post-title" title="MircroPython">MircroPython</span>
            <span class="post-date" title="2023-11-08 18:02:31">2023/11/08</span>
        </a>
        
        <a  class="全部文章 算法 数学 "
           href="/2023/11/01/Q-rsqrt/"
           data-tag="快速平方根"
           data-author="" >
            <span class="post-title" title="Q_rsqrt">Q_rsqrt</span>
            <span class="post-date" title="2023-11-01 08:52:08">2023/11/01</span>
        </a>
        
        <a  class="全部文章 工具 audio "
           href="/2023/10/16/audioConvert/"
           data-tag="python,audio"
           data-author="" >
            <span class="post-title" title="audioConvert">audioConvert</span>
            <span class="post-date" title="2023-10-16 19:34:43">2023/10/16</span>
        </a>
        
        <a  class="全部文章 物联网 设备端 "
           href="/2023/10/14/STM32/"
           data-tag="STM32"
           data-author="" >
            <span class="post-title" title="STM32">STM32</span>
            <span class="post-date" title="2023-10-14 08:59:19">2023/10/14</span>
        </a>
        
        <a  class="全部文章 物联网 设备端 "
           href="/2023/10/08/51C/"
           data-tag="51C"
           data-author="" >
            <span class="post-title" title="51C">51C</span>
            <span class="post-date" title="2023-10-08 17:20:10">2023/10/08</span>
        </a>
        
        <a  class="全部文章 算法 面试题 "
           href="/2023/09/18/JobInterview/"
           data-tag="N的阶乘"
           data-author="" >
            <span class="post-title" title="JobInterview">JobInterview</span>
            <span class="post-date" title="2023-09-18 21:55:19">2023/09/18</span>
        </a>
        
        <a  class="全部文章 算法 LeetCode "
           href="/2023/09/13/hot100/"
           data-tag="LeetCode"
           data-author="" >
            <span class="post-title" title="hot100">hot100</span>
            <span class="post-date" title="2023-09-13 10:17:00">2023/09/13</span>
        </a>
        
        <a  class="全部文章 后端 Java "
           href="/2023/09/05/4Job/"
           data-tag="Job,WebGIS,Shell"
           data-author="" >
            <span class="post-title" title="Javaer&#39;s development">Javaer&#39;s development</span>
            <span class="post-date" title="2023-09-05 00:00:00">2023/09/05</span>
        </a>
        
        <a  class="全部文章 后端 Java "
           href="/2023/03/24/Stream/"
           data-tag="Stream"
           data-author="" >
            <span class="post-title" title="Stream">Stream</span>
            <span class="post-date" title="2023-03-24 09:42:49">2023/03/24</span>
        </a>
        
        <a  class="全部文章 物联网 设备端 "
           href="/2023/03/08/ESP32ATLog/"
           data-tag="ESP32,AT"
           data-author="" >
            <span class="post-title" title="ESP32AT指令集探索">ESP32AT指令集探索</span>
            <span class="post-date" title="2023-03-08 14:52:56">2023/03/08</span>
        </a>
        
        <a  class="全部文章 工具 插件 "
           href="/2023/02/09/AddOn4SpeedPlay/"
           data-tag="video"
           data-author="" >
            <span class="post-title" title="AddOn4SpeedPlay">AddOn4SpeedPlay</span>
            <span class="post-date" title="2023-02-09 13:05:26">2023/02/09</span>
        </a>
        
        <a  class="全部文章 工具 ChatGPT "
           href="/2023/02/09/ChatGPT/"
           data-tag="ChatGPT"
           data-author="" >
            <span class="post-title" title="Usage of ChatGPT">Usage of ChatGPT</span>
            <span class="post-date" title="2023-02-09 12:34:54">2023/02/09</span>
        </a>
        
        <a  class="全部文章 后端 Java "
           href="/2023/02/09/Java-io/"
           data-tag="IO"
           data-author="" >
            <span class="post-title" title="Java-io">Java-io</span>
            <span class="post-date" title="2023-02-09 12:27:55">2023/02/09</span>
        </a>
        
        <a  class="全部文章 工具 插件 "
           href="/2023/01/17/Freedom/"
           data-tag="油猴"
           data-author="" >
            <span class="post-title" title="Videos">Videos</span>
            <span class="post-date" title="2023-01-17 21:43:30">2023/01/17</span>
        </a>
        
        <a  class="全部文章 后端 Java "
           href="/2022/12/04/DevConcludes/"
           data-tag="开发"
           data-author="" >
            <span class="post-title" title="DevConcludes">DevConcludes</span>
            <span class="post-date" title="2022-12-04 22:16:46">2022/12/04</span>
        </a>
        
        <a  class="全部文章 后端 Java "
           href="/2022/10/16/Java-Utils/"
           data-tag="Utils"
           data-author="" >
            <span class="post-title" title="Java-Utils">Java-Utils</span>
            <span class="post-date" title="2022-10-16 16:15:29">2022/10/16</span>
        </a>
        
        <a  class="全部文章 算法 数组 "
           href="/2022/05/02/Array/"
           data-tag="数组"
           data-author="" >
            <span class="post-title" title="数组">数组</span>
            <span class="post-date" title="2022-05-02 00:00:00">2022/05/02</span>
        </a>
        
        <a  class="全部文章 算法 图 "
           href="/2022/01/23/TopologicalSorting/"
           data-tag="图"
           data-author="" >
            <span class="post-title" title="拓扑排序">拓扑排序</span>
            <span class="post-date" title="2022-01-23 00:00:00">2022/01/23</span>
        </a>
        
        <a  class="全部文章 算法 图 "
           href="/2021/12/31/Graph-DataStructure/"
           data-tag="图"
           data-author="" >
            <span class="post-title" title="图的数据结构">图的数据结构</span>
            <span class="post-date" title="2021-12-31 10:41:29">2021/12/31</span>
        </a>
        
        <a  class="全部文章 后端 设计模式 "
           href="/2021/12/30/DesignPatternofSixPrinciples/"
           data-tag="六大原则"
           data-author="" >
            <span class="post-title" title="六大设计原则">六大设计原则</span>
            <span class="post-date" title="2021-12-30 15:11:05">2021/12/30</span>
        </a>
        
        <a  class="全部文章 算法 树 "
           href="/2021/12/13/BinaryTree-traverse/"
           data-tag="二叉树"
           data-author="" >
            <span class="post-title" title="二叉树的遍历框架">二叉树的遍历框架</span>
            <span class="post-date" title="2021-12-13 10:50:34">2021/12/13</span>
        </a>
        
        <a  class="全部文章 算法 "
           href="/2021/12/08/Trie-341-NestedIterator/"
           data-tag="前缀树,N叉树,迭代器"
           data-author="" >
            <span class="post-title" title="扁平化嵌套列表迭代器">扁平化嵌套列表迭代器</span>
            <span class="post-date" title="2021-12-08 16:38:11">2021/12/08</span>
        </a>
        
        <a  class="全部文章 算法 树 "
           href="/2021/11/26/BinaryTree-297-SerializeAndDeserialize/"
           data-tag="二叉树"
           data-author="" >
            <span class="post-title" title="二叉树的序列化和反序列化">二叉树的序列化和反序列化</span>
            <span class="post-date" title="2021-11-26 17:32:54">2021/11/26</span>
        </a>
        
        <a  class="全部文章 算法 日期 "
           href="/2021/09/16/Calculate-date/"
           data-tag="闰年"
           data-author="" >
            <span class="post-title" title="Calculate_date">Calculate_date</span>
            <span class="post-date" title="2021-09-16 21:05:01">2021/09/16</span>
        </a>
        
        <a  class="全部文章 后端 设计模式 "
           href="/2021/09/15/DesignPatterofStrategy/"
           data-tag="行为型模式,策略模式"
           data-author="" >
            <span class="post-title" title="策略模式">策略模式</span>
            <span class="post-date" title="2021-09-15 20:58:14">2021/09/15</span>
        </a>
        
        <a  class="全部文章 后端 设计模式 "
           href="/2021/09/15/DesignPatternofObserver/"
           data-tag="观察者模式,行为型模式"
           data-author="" >
            <span class="post-title" title="观察者模式">观察者模式</span>
            <span class="post-date" title="2021-09-15 20:41:49">2021/09/15</span>
        </a>
        
        <a  class="全部文章 后端 设计模式 "
           href="/2021/09/15/DesignPatternofProxy/"
           data-tag="代理模式,结构型模式"
           data-author="" >
            <span class="post-title" title="代理模式">代理模式</span>
            <span class="post-date" title="2021-09-15 20:30:32">2021/09/15</span>
        </a>
        
        <a  class="全部文章 算法 "
           href="/2021/09/07/PriorityQueue/"
           data-tag="优先队列,贪心"
           data-author="" >
            <span class="post-title" title="PriorityQueue">PriorityQueue</span>
            <span class="post-date" title="2021-09-07 00:00:00">2021/09/07</span>
        </a>
        
        <a  class="全部文章 算法 基础 "
           href="/2021/08/31/SearchAndSort/"
           data-tag="排序,查找"
           data-author="" >
            <span class="post-title" title="SearchAndSort">SearchAndSort</span>
            <span class="post-date" title="2021-08-31 14:27:08">2021/08/31</span>
        </a>
        
        <a  class="全部文章 后端 Java "
           href="/2021/08/13/HashSet-HashMap-analyse/"
           data-tag="集合,Set,Map"
           data-author="" >
            <span class="post-title" title="HashMap">HashMap</span>
            <span class="post-date" title="2021-08-13 14:59:19">2021/08/13</span>
        </a>
        
        <a  class="全部文章 后端 Java "
           href="/2021/08/13/LinkedList-analyse/"
           data-tag="集合,LinkedList"
           data-author="" >
            <span class="post-title" title="LinkedList-analyse">LinkedList-analyse</span>
            <span class="post-date" title="2021-08-13 13:19:52">2021/08/13</span>
        </a>
        
        <a  class="全部文章 后端 Java "
           href="/2021/08/13/Vector-analyse/"
           data-tag="集合,List,Vector"
           data-author="" >
            <span class="post-title" title="Vector-analyse">Vector-analyse</span>
            <span class="post-date" title="2021-08-13 11:42:21">2021/08/13</span>
        </a>
        
        <a  class="全部文章 后端 Java "
           href="/2021/08/13/Arraylist-analyse/"
           data-tag="集合,List,ArrayList"
           data-author="" >
            <span class="post-title" title="Arraylist_analyse">Arraylist_analyse</span>
            <span class="post-date" title="2021-08-13 08:59:00">2021/08/13</span>
        </a>
        
        <a  class="全部文章 后端 Java "
           href="/2021/08/10/Java-JUC/"
           data-tag="多线程"
           data-author="" >
            <span class="post-title" title="Java_JUC">Java_JUC</span>
            <span class="post-date" title="2021-08-10 20:42:30">2021/08/10</span>
        </a>
        
        <a  class="全部文章 算法 树 "
           href="/2021/07/09/Trie/"
           data-tag="前缀树,N叉树"
           data-author="" >
            <span class="post-title" title="过滤敏感词">过滤敏感词</span>
            <span class="post-date" title="2021-07-09 00:00:00">2021/07/09</span>
        </a>
        
        <a  class="全部文章 算法 滑动窗口 "
           href="/2021/07/02/slidingwindow/"
           data-tag="滑动窗口"
           data-author="" >
            <span class="post-title" title="滑动窗口">滑动窗口</span>
            <span class="post-date" title="2021-07-02 00:00:00">2021/07/02</span>
        </a>
        
        <a  class="全部文章 算法 双指针 "
           href="/2021/07/01/doublepointers/"
           data-tag="双指针"
           data-author="" >
            <span class="post-title" title="双指针">双指针</span>
            <span class="post-date" title="2021-07-01 00:00:00">2021/07/01</span>
        </a>
        
        <a  class="全部文章 数据库 Redis "
           href="/2021/06/29/redis-LearningNote/"
           data-tag="NoSQL"
           data-author="" >
            <span class="post-title" title="redis学习笔记">redis学习笔记</span>
            <span class="post-date" title="2021-06-29 00:00:00">2021/06/29</span>
        </a>
        
        <a  class="全部文章 算法 日期 "
           href="/2021/06/27/Zeller/"
           data-tag="蔡勒公式,OJ"
           data-author="" >
            <span class="post-title" title="Week = (Day + 2*Month + 3*(Month+1)/5 + Year + Year/4 - Year/100 + Year/400) % 7">Week = (Day + 2*Month + 3*(Month+1)/5 + Year + Year/4 - Year/100 + Year/400) % 7</span>
            <span class="post-date" title="2021-06-27 00:00:00">2021/06/27</span>
        </a>
        
        <a  class="全部文章 算法 树 "
           href="/2021/06/01/BinaryTree/"
           data-tag="二叉树"
           data-author="" >
            <span class="post-title" title="二叉树">二叉树</span>
            <span class="post-date" title="2021-06-01 00:00:00">2021/06/01</span>
        </a>
        
        <a  class="全部文章 linux 三剑客 "
           href="/2021/05/27/linuxLearningNote/"
           data-tag="linux,grep,sed,awk"
           data-author="" >
            <span class="post-title" title="排查问题">排查问题</span>
            <span class="post-date" title="2021-05-27 00:00:00">2021/05/27</span>
        </a>
        
        <a  class="全部文章 Python "
           href="/2021/05/05/Resnet/"
           data-tag="DL,Resnet"
           data-author="" >
            <span class="post-title" title="Resnet">Resnet</span>
            <span class="post-date" title="2021-05-05 00:00:00">2021/05/05</span>
        </a>
        
        <a  class="全部文章 后端 Java "
           href="/2021/04/29/Java-polymorphism/"
           data-tag="多态"
           data-author="" >
            <span class="post-title" title="Java-polymorphism">Java-polymorphism</span>
            <span class="post-date" title="2021-04-29 00:00:00">2021/04/29</span>
        </a>
        
        <a  class="全部文章 后端 设计模式 "
           href="/2021/04/14/DesignPatternofBuilder/"
           data-tag="建造者模式,构建型模式"
           data-author="" >
            <span class="post-title" title="建造者模式">建造者模式</span>
            <span class="post-date" title="2021-04-14 00:00:00">2021/04/14</span>
        </a>
        
        <a  class="全部文章 后端 设计模式 "
           href="/2021/04/10/DesignPatternofSingleton/"
           data-tag="构建型模式,单例模式"
           data-author="" >
            <span class="post-title" title="单例模式">单例模式</span>
            <span class="post-date" title="2021-04-10 00:00:00">2021/04/10</span>
        </a>
        
        <a  class="全部文章 前端 "
           href="/2021/04/09/JavaScript-Note/"
           data-tag="前端,JavaScript"
           data-author="" >
            <span class="post-title" title="JavaScript">JavaScript</span>
            <span class="post-date" title="2021-04-09 14:27:00">2021/04/09</span>
        </a>
        
        <a  class="全部文章 Python pytorch "
           href="/2021/04/09/DockerPractice/"
           data-tag="pytorch"
           data-author="" >
            <span class="post-title" title="pytorch">pytorch</span>
            <span class="post-date" title="2021-04-09 00:00:00">2021/04/09</span>
        </a>
        
        <a  class="全部文章 工具 git "
           href="/2021/04/06/GitLearningNote-2/"
           data-tag="git"
           data-author="" >
            <span class="post-title" title="git学习笔记">git学习笔记</span>
            <span class="post-date" title="2021-04-06 00:00:00">2021/04/06</span>
        </a>
        
        <a  class="全部文章 后端 设计模式 "
           href="/2021/04/02/DesignPatternofPrototype/"
           data-tag="构建型模式,原型模式"
           data-author="" >
            <span class="post-title" title="原型模式">原型模式</span>
            <span class="post-date" title="2021-04-02 00:00:00">2021/04/02</span>
        </a>
        
        <a  class="全部文章 后端 设计模式 "
           href="/2021/03/30/DesignPatternofFactory/"
           data-tag="创建型模式,简单工厂模式,工厂方法模式,抽象工厂模式"
           data-author="" >
            <span class="post-title" title="工厂模式">工厂模式</span>
            <span class="post-date" title="2021-03-30 00:00:00">2021/03/30</span>
        </a>
        
        <a  class="全部文章 数据库 MySQL "
           href="/2021/03/23/MySQLearningNote/"
           data-tag="SQL,约束,数据库的设计,数据库的备份和还原,多表查询,事务"
           data-author="" >
            <span class="post-title" title="MySQL学习笔记">MySQL学习笔记</span>
            <span class="post-date" title="2021-03-23 00:00:00">2021/03/23</span>
        </a>
        
        <a  class="全部文章 docker "
           href="/2021/03/19/DockerLearningNoteBase/"
           data-tag="docker,镜像,容器"
           data-author="" >
            <span class="post-title" title="Docker笔记">Docker笔记</span>
            <span class="post-date" title="2021-03-19 00:00:00">2021/03/19</span>
        </a>
        
        <a  class="全部文章 后端 C# "
           href="/2020/10/16/Ado-.net/"
           data-tag="C#,Ado.net"
           data-author="" >
            <span class="post-title" title="Ado.net">Ado.net</span>
            <span class="post-date" title="2020-10-16 00:00:00">2020/10/16</span>
        </a>
        
        <a  class="全部文章 工具 github "
           href="/2020/10/12/GitHubSearch/"
           data-tag="github"
           data-author="" >
            <span class="post-title" title="学会在github上搜索项目">学会在github上搜索项目</span>
            <span class="post-date" title="2020-10-12 13:55:57">2020/10/12</span>
        </a>
        
        <a  class="全部文章 后端 C# "
           href="/2020/09/21/Event-publisher-subscriber/"
           data-tag="C#,委托与事件"
           data-author="" >
            <span class="post-title" title="Event_publisher_subscriber">Event_publisher_subscriber</span>
            <span class="post-date" title="2020-09-21 15:17:32">2020/09/21</span>
        </a>
        
        <a  class="全部文章 沉淀一下 "
           href="/2019/12/16/SoftwareDesignTest/"
           data-tag="原码, 反码, 补码, 移码,进制转换"
           data-author="" >
            <span class="post-title" title="软件设计师">软件设计师</span>
            <span class="post-date" title="2019-12-16 10:46:08">2019/12/16</span>
        </a>
        
        <a  class="全部文章 工具 "
           href="/2019/12/03/douban-spider/"
           data-tag="爬虫,Python"
           data-author="" >
            <span class="post-title" title="豆瓣排行榜小爬虫">豆瓣排行榜小爬虫</span>
            <span class="post-date" title="2019-12-03 00:00:00">2019/12/03</span>
        </a>
        
        <a  class="全部文章 工具 "
           href="/2019/09/30/Crawler/"
           data-tag="爬虫,http"
           data-author="" >
            <span class="post-title" title="什么是网络爬虫">什么是网络爬虫</span>
            <span class="post-date" title="2019-09-30 14:35:05">2019/09/30</span>
        </a>
        
        <a  class="全部文章 Python "
           href="/2019/08/31/PythonNote/"
           data-tag="Python"
           data-author="" >
            <span class="post-title" title="Python课堂笔记">Python课堂笔记</span>
            <span class="post-date" title="2019-08-31 14:28:16">2019/08/31</span>
        </a>
        
        <a  class="全部文章 工具 git "
           href="/2019/08/10/HowToMakeBlog/"
           data-tag="博客搭建"
           data-author="" >
            <span class="post-title" title="搭建hexo博客">搭建hexo博客</span>
            <span class="post-date" title="2019-08-10 00:00:00">2019/08/10</span>
        </a>
        
        <a  class="全部文章 工具 git "
           href="/2019/06/13/GitLearningNote-1/"
           data-tag="git"
           data-author="" >
            <span class="post-title" title="git 初试">git 初试</span>
            <span class="post-date" title="2019-06-13 00:00:00">2019/06/13</span>
        </a>
        
        <a  class="全部文章 工具 "
           href="/2019/06/13/On-the-Internet-Scientifically/"
           data-tag="shadowsocks"
           data-author="" >
            <span class="post-title" title="科学上网">科学上网</span>
            <span class="post-date" title="2019-06-13 00:00:00">2019/06/13</span>
        </a>
        
        <div id="no-item-tips">

        </div>
    </nav>
    <div id="outline-list">
    </div>
</div>
    </div>
    <div class="hide-list">
        <div class="semicircle" data-title="切换全屏 快捷键 s">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div id="post">
    <div class="pjax">
        <article id="post-esp-idf-record" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">esp-idf-record</h1>
    
    <div class="article-meta">
        
        
        
        <span class="book">
            <i class="iconfont icon-category"></i>
            
            
            <a  data-rel="物联网">物联网</a> > 
            
            <a  data-rel="物联网&lt;---&gt;乐鑫">乐鑫</a>
            
        </span>
        
        
        <span class="tag">
            <i class="iconfont icon-tag"></i>
            
            <a class="color3">esp-idf</a>
            
        </span>
        
    </div>
    <div class="article-meta">
        
            发布时间 : <time class="date" title='最后更新: 2025-01-02 18:01:36'>2024-12-30 10:46</time>
        
    </div>
    <div class="article-meta">
        
        <span>字数:10.8k</span>
        
        
        <span id="busuanzi_container_page_pv">
            阅读 :<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
        <span class="top-comment" title="跳转至评论区">
            <a href="#comments">
                评论:<span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </a>
        </span>
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#ESP32-Board%E5%8E%9F%E7%90%86%E5%9B%BE"><span class="toc-text">ESP32-Board原理图</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#WS2812"><span class="toc-text">WS2812</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#RMT%E6%8E%A7%E5%88%B6"><span class="toc-text">RMT控制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E4%BB%A3%E7%A0%81"><span class="toc-text">核心代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#main-c"><span class="toc-text">main.c</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#led-ws2812-c"><span class="toc-text">led_ws2812.c</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#led-ws2812-h"><span class="toc-text">led_ws2812.h</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DHT11"><span class="toc-text">DHT11</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#main-c-1"><span class="toc-text">main.c</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ADC-%E7%83%AD%E6%95%8F%E7%94%B5%E9%98%BB"><span class="toc-text">ADC-热敏电阻</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-1"><span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#main-c-2"><span class="toc-text">main.c</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ntc-c"><span class="toc-text">ntc.c</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ntc-h"><span class="toc-text">ntc.h</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#HC-SR04%E8%B6%85%E5%A3%B0%E6%B3%A2%E4%BC%A0%E6%84%9F%E5%99%A8"><span class="toc-text">HC-SR04超声波传感器</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-2"><span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#main-c-3"><span class="toc-text">main.c</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SD-sdmmc"><span class="toc-text">SD-sdmmc</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-3"><span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#main-c-4"><span class="toc-text">main.c</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#UART"><span class="toc-text">UART</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-text">1. 工作原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F"><span class="toc-text">2. 数据格式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%B3%A2%E7%89%B9%E7%8E%87"><span class="toc-text">3. 波特率</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E7%A1%AC%E4%BB%B6%E8%BF%9E%E6%8E%A5"><span class="toc-text">4. 硬件连接</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GPIO%E4%BA%A4%E6%8D%A2%E7%9F%A9%E9%98%B5"><span class="toc-text">GPIO交换矩阵</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%A6%82%E5%BF%B5"><span class="toc-text">1. 概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-text">2. 工作原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E4%B8%BB%E8%A6%81%E7%89%B9%E7%82%B9"><span class="toc-text">3. 主要特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-text">4. 应用场景</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="toc-text">代码示例</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SPI-ST7789-%E6%98%BE%E7%A4%BA%E5%B1%8F"><span class="toc-text">SPI-ST7789-显示屏</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#SPI%E4%BB%8B%E7%BB%8D"><span class="toc-text">SPI介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SPI%E5%9B%9B%E7%A7%8D%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F"><span class="toc-text">SPI四种工作模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#st7789-driver-h"><span class="toc-text">st7789_driver.h</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#st7789-driver-c"><span class="toc-text">st7789_driver.c</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#main-c-5"><span class="toc-text">main.c</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#I2C-CST816T-%E8%A7%A6%E6%91%B8%E5%B1%8F"><span class="toc-text">I2C-CST816T-触摸屏</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#I2C%E4%BB%8B%E7%BB%8D"><span class="toc-text">I2C介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cst816t-h"><span class="toc-text">cst816t.h</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cst816t-c"><span class="toc-text">cst816t.c</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#main-c-6"><span class="toc-text">main.c</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#LVGL"><span class="toc-text">LVGL</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D"><span class="toc-text">组件介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E7%BB%84%E4%BB%B6"><span class="toc-text">添加组件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%87%E6%8D%A2%E7%89%88%E6%9C%AC"><span class="toc-text">切换版本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lv-port-c"><span class="toc-text">lv_port.c</span></a></li></ol></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="ESP32-Board原理图"><a href="#ESP32-Board原理图" class="headerlink" title="ESP32-Board原理图"></a>ESP32-Board原理图</h1><p><img src="/2024/12/30/esp-idf-record/image-20241231151051185.png" alt="image-20241231151051185"></p>
<h1 id="WS2812"><a href="#WS2812" class="headerlink" title="WS2812"></a>WS2812</h1><h2 id="RMT控制"><a href="#RMT控制" class="headerlink" title="RMT控制"></a>RMT控制</h2><p><img src="/2024/12/30/esp-idf-record/image-20241230110406838.png" alt="image-20241230110406838"></p>
<p><img src="/2024/12/30/esp-idf-record/image-20241230110449396.png" alt="image-20241230110449396"></p>
<p><img src="/2024/12/30/esp-idf-record/image-20241230110640812.png" alt="image-20241230110640812"></p>
<p><img src="/2024/12/30/esp-idf-record/image-20241230104747866.png" alt="image-20241230104747866"></p>
<h2 id="核心代码"><a href="#核心代码" class="headerlink" title="核心代码"></a>核心代码</h2><h2 id="main-c"><a href="#main-c" class="headerlink" title="main.c"></a>main.c</h2><pre><code class="c">/*
 * SPDX-FileCopyrightText: 2021-2022 Espressif Systems (Shanghai) CO LTD
 *
 * SPDX-License-Identifier: Unlicense OR CC0-1.0
 */
#include &lt;string.h&gt;
#include &quot;freertos/FreeRTOS.h&quot;
#include &quot;freertos/task.h&quot;
#include &quot;esp_log.h&quot;
#include &quot;driver/rmt_tx.h&quot;
#include &quot;led_ws2812.h&quot;

#define WS2812_GPIO_NUM     GPIO_NUM_26
#define WS2812_LED_NUM      12

/** HSV转RGB ，暂无用到
 * @brief 将HSV色彩空间转换为RGB色彩空间。
 * 
 * @param h 色相（0-360）
 * @param s 饱和度（0-100）
 * @param v 明度（此处按百分比0-100缩放，实际对应8位时为0-255）
 * @param r 指针，用于存储计算出的红色分量（0-255）
 * @param g 指针，用于存储计算出的绿色分量（0-255）
 * @param b 指针，用于存储计算出的蓝色分量（0-255）
 * @return 无
 */
void led_strip_hsv2rgb(uint32_t h, uint32_t s, uint32_t v, uint32_t *r, uint32_t *g, uint32_t *b)
&#123;
    h %= 360; // 将色相规范化到[0,360)范围内

    // 将明度从[0,100]缩放到[0,255]，饱和度保持在[0,100]
    uint32_t rgb_max = v * 2.55f; // 基于明度的RGB分量的最大值
    uint32_t rgb_min = rgb_max * (100 - s) / 100.0f; // 基于饱和度和明度的RGB分量的最小值

    uint32_t i = h / 60; // 确定色相圆上的扇区（0-5）
    uint32_t diff = h % 60; // 扇区内剩余的部分

    // 根据扇区内的色相计算RGB调整量
    uint32_t rgb_adj = (rgb_max - rgb_min) * diff / 60;

    // 根据扇区计算RGB值
    switch (i) &#123;
    case 0: // 红色到黄色
        *r = rgb_max;
        *g = rgb_min + rgb_adj;
        *b = rgb_min;
        break;
    case 1: // 黄色到绿色
        *r = rgb_max - rgb_adj;
        *g = rgb_max;
        *b = rgb_min;
        break;
    case 2: // 绿色到青色
        *r = rgb_min;
        *g = rgb_max;
        *b = rgb_min + rgb_adj;
        break;
    case 3: // 青色到蓝色
        *r = rgb_min;
        *g = rgb_max - rgb_adj;
        *b = rgb_max;
        break;
    case 4: // 蓝色到洋红色
        *r = rgb_min + rgb_adj;
        *g = rgb_min;
        *b = rgb_max;
        break;
    default: // 洋红色到红色
        *r = rgb_max;
        *g = rgb_min;
        *b = rgb_max - rgb_adj;
        break;
    &#125;
&#125;


void app_main(void)
&#123;
    ws2812_strip_handle_t ws2812_handle = NULL;
    int index = 0;
    // 初始化WS2812 LED灯带
    ws2812_init(WS2812_GPIO_NUM, WS2812_LED_NUM, &amp;ws2812_handle);

    while(1)
    &#123;
        // 红色跑马灯
        // 遍历每个LED，逐个点亮红色LED
        for(index = 0; index &lt; WS2812_LED_NUM; index++)
        &#123;
            uint32_t r = 230, g = 20, b = 20; // 设定RGB值为红色
            ws2812_write(ws2812_handle, index, r, g, b); // 将当前LED设置为红色
            vTaskDelay(pdMS_TO_TICKS(80)); // 延迟80毫秒
        &#125;

        // 绿色跑马灯
        // 遍历每个LED，逐个点亮绿色LED
        for(index = 0; index &lt; WS2812_LED_NUM; index++)
        &#123;
            uint32_t r = 20, g = 230, b = 20; // 设定RGB值为绿色
            ws2812_write(ws2812_handle, index, r, g, b); // 将当前LED设置为绿色
            vTaskDelay(pdMS_TO_TICKS(80)); // 延迟80毫秒
        &#125;

        // 蓝色跑马灯
        // 遍历每个LED，逐个点亮蓝色LED
        for(index = 0; index &lt; WS2812_LED_NUM; index++)
        &#123;
            uint32_t r = 20, g = 20, b = 230; // 设定RGB值为蓝色
            ws2812_write(ws2812_handle, index, r, g, b); // 将当前LED设置为蓝色
            vTaskDelay(pdMS_TO_TICKS(80)); // 延迟80毫秒
        &#125;
    &#125;

&#125;
</code></pre>
<h2 id="led-ws2812-c"><a href="#led-ws2812-c" class="headerlink" title="led_ws2812.c"></a>led_ws2812.c</h2><pre><code class="c">/*
 * SPDX-FileCopyrightText: 2021-2022 Espressif Systems (Shanghai) CO LTD
 *
 * SPDX-License-Identifier: Apache-2.0
 */

#include &quot;esp_check.h&quot;
#include &quot;led_ws2812.h&quot;
#include &quot;driver/rmt_tx.h&quot;

static const char *TAG = &quot;led_encoder&quot;;

#define LED_STRIP_RESOLUTION_HZ 10000000 // 10MHz 分辨率, 也就是1tick = 0.1us，也就是可以控制的最小时间单元，低于0.1us的脉冲无法产生

//WS2812驱动的描述符
struct ws2812_strip_t
&#123;
    rmt_channel_handle_t led_chan;          //rmt通道
    rmt_encoder_handle_t led_encoder;       //rmt编码器
    uint8_t *led_buffer;                    //rgb数据
    int led_num;                            //led个数
&#125;;

//自定义编码器
typedef struct &#123;
    rmt_encoder_t base;                     //编码器，里面包含三个需要用户实现的回调函数，encode,del,ret
    rmt_encoder_t *bytes_encoder;           //字节编码器，调用rmt_new_bytes_encoder函数后创建
    rmt_encoder_t *copy_encoder;            //拷贝编码器，调用rmt_new_copy_encoder函数后创建
    int state;                              //状态控制
    rmt_symbol_word_t reset_code;           //结束位的时序
&#125; rmt_led_strip_encoder_t;

/* 发送WS2812数据的函数调用顺序如下
 * 1、调用rmt_transmit，需传入RMT通道、发送的数据、编码器参数
 * 2、调用编码器的encode函数，在本例程中就是调用rmt_encode_led_strip函数
 * 3、调用由rmt_new_bytes_encoder创建的字节编码器编码函数bytes_encoder-&gt;encode，将用户数据编码成rmt_symbol_word_t RMT符号
 * 4、调用由rmt_new_copy_encoder创建的拷贝编码器编码函数copy_encoder-&gt;encode，将复位信号安装既定的电平时间进行编码
 * 5、rmt_encode_led_strip函数返回，在底层将信号发送出去（本质上是操作IO管脚高低电平）
*/

/** 编码回调函数
 * @param encoder 编码器
 * @param channel RMT通道
 * @param primary_data 待编码用户数据
 * @param data_size 待编码用户数据长度
 * @param ret_state 编码状态
 * @return RMT符号个数
*/
static size_t rmt_encode_led_strip(rmt_encoder_t *encoder, rmt_channel_handle_t channel, const void *primary_data, size_t data_size, rmt_encode_state_t *ret_state)
&#123;
    /*
    __containerof宏的作用:
    通过结构的成员来访问这个结构的地址
    在这个函数中，传入参数encoder是rmt_led_strip_encoder_t结构体中的base成员
    __containerof宏通过encoder的地址，根据rmt_led_strip_encoder_t的内存排布找到rmt_led_strip_encoder_t* 的首地址
    */
    rmt_led_strip_encoder_t *led_encoder = __containerof(encoder, rmt_led_strip_encoder_t, base);
    rmt_encoder_handle_t bytes_encoder = led_encoder-&gt;bytes_encoder;        //取出字节编码器
    rmt_encoder_handle_t copy_encoder = led_encoder-&gt;copy_encoder;          //取出拷贝编码器
    rmt_encode_state_t session_state = RMT_ENCODING_RESET;
    rmt_encode_state_t state = RMT_ENCODING_RESET;
    size_t encoded_symbols = 0;
    switch (led_encoder-&gt;state) &#123;   //led_encoder-&gt;state是自定义的状态，这里只有两种值，0是发送RGB数据，1是发送复位码
    case 0: // send RGB data
        encoded_symbols += bytes_encoder-&gt;encode(bytes_encoder, channel, primary_data, data_size, &amp;session_state);
        if (session_state &amp; RMT_ENCODING_COMPLETE) &#123;    //字节编码完成
            led_encoder-&gt;state = 1; // switch to next state when current encoding session finished
        &#125;
        if (session_state &amp; RMT_ENCODING_MEM_FULL) &#123;    //缓存不足，本次退出
            state |= RMT_ENCODING_MEM_FULL;
            goto out; // yield if there&#39;s no free space for encoding artifacts
        &#125;
    // fall-through
    case 1: // send reset code
        encoded_symbols += copy_encoder-&gt;encode(copy_encoder, channel, &amp;led_encoder-&gt;reset_code,
                                                sizeof(led_encoder-&gt;reset_code), &amp;session_state);
        if (session_state &amp; RMT_ENCODING_COMPLETE) &#123;
            led_encoder-&gt;state = RMT_ENCODING_RESET; // back to the initial encoding session
            state |= RMT_ENCODING_COMPLETE;
        &#125;
        if (session_state &amp; RMT_ENCODING_MEM_FULL) &#123;
            state |= RMT_ENCODING_MEM_FULL;
            goto out; // yield if there&#39;s no free space for encoding artifacts
        &#125;
    &#125;
out:
    *ret_state = state;
    return encoded_symbols;
&#125;

/**
 * @brief 删除LED灯带编码器
 *
 * 删除指定的LED灯带编码器，并释放相关资源。
 *
 * @param encoder 指向要删除的LED灯带编码器的指针
 *
 * @return ESP_OK 表示成功，其他值表示失败
 */
static esp_err_t rmt_del_led_strip_encoder(rmt_encoder_t *encoder)
&#123;
    rmt_led_strip_encoder_t *led_encoder = __containerof(encoder, rmt_led_strip_encoder_t, base);
    rmt_del_encoder(led_encoder-&gt;bytes_encoder);
    rmt_del_encoder(led_encoder-&gt;copy_encoder);
    free(led_encoder);
    return ESP_OK;
&#125;

/**
 * @brief 重置LED灯带编码器
 *
 * 将LED灯带编码器的状态重置为初始状态。
 *
 * @param encoder LED灯带编码器指针
 *
 * @return esp_err_t 类型为 esp_err_t 的错误码。成功时返回 ESP_OK。
 */
static esp_err_t rmt_led_strip_encoder_reset(rmt_encoder_t *encoder)
&#123;
    rmt_led_strip_encoder_t *led_encoder = __containerof(encoder, rmt_led_strip_encoder_t, base);
    rmt_encoder_reset(led_encoder-&gt;bytes_encoder);
    rmt_encoder_reset(led_encoder-&gt;copy_encoder);
    led_encoder-&gt;state = RMT_ENCODING_RESET;
    return ESP_OK;
&#125;

/** 创建一个基于WS2812时序的编码器
 * @param ret_encoder 返回的编码器，这个编码器在使用rmt_transmit函数传输时会用到
 * @return ESP_OK or ESP_FAIL
*/
esp_err_t rmt_new_led_strip_encoder(rmt_encoder_handle_t *ret_encoder)
&#123;
    esp_err_t ret = ESP_OK;

    //创建一个自定义的编码器结构体，用于控制发送编码的流程
    rmt_led_strip_encoder_t *led_encoder = NULL;
    led_encoder = calloc(1, sizeof(rmt_led_strip_encoder_t));
    ESP_GOTO_ON_FALSE(led_encoder, ESP_ERR_NO_MEM, err, TAG, &quot;no mem for led strip encoder&quot;);
    led_encoder-&gt;base.encode = rmt_encode_led_strip;    //这个函数会在rmt发送数据的时候被调用，我们可以在这个函数增加额外代码进行控制
    led_encoder-&gt;base.del = rmt_del_led_strip_encoder;  //这个函数在卸载rmt时被调用
    led_encoder-&gt;base.reset = rmt_led_strip_encoder_reset;  //这个函数在复位rmt时被调用

    //新建一个编码器配置(0,1位持续时间，参考芯片手册)
    rmt_bytes_encoder_config_t bytes_encoder_config = &#123;
        .bit0 = &#123;
            .level0 = 1,
            .duration0 = 0.3 * LED_STRIP_RESOLUTION_HZ / 1000000, // T0H=0.3us
            .level1 = 0,
            .duration1 = 0.9 * LED_STRIP_RESOLUTION_HZ / 1000000, // T0L=0.9us
        &#125;,
        .bit1 = &#123;
            .level0 = 1,
            .duration0 = 0.9 * LED_STRIP_RESOLUTION_HZ / 1000000, // T1H=0.9us
            .level1 = 0,
            .duration1 = 0.3 * LED_STRIP_RESOLUTION_HZ / 1000000, // T1L=0.3us
        &#125;,
        .flags.msb_first = 1 //高位先传输
    &#125;;
    //传入编码器配置，获得数据编码器操作句柄
    rmt_new_bytes_encoder(&amp;bytes_encoder_config, &amp;led_encoder-&gt;bytes_encoder);

    //新建一个拷贝编码器配置，拷贝编码器一般用于传输恒定的字符数据，比如说结束位
    rmt_copy_encoder_config_t copy_encoder_config = &#123;&#125;;
    rmt_new_copy_encoder(&amp;copy_encoder_config, &amp;led_encoder-&gt;copy_encoder);

    //设定结束位时序
    uint32_t reset_ticks = LED_STRIP_RESOLUTION_HZ / 1000000 * 50 / 2; //分辨率/1M=每个ticks所需的us，然后乘以50就得出50us所需的ticks
    led_encoder-&gt;reset_code = (rmt_symbol_word_t) &#123;
        .level0 = 0,
        .duration0 = reset_ticks,
        .level1 = 0,
        .duration1 = reset_ticks,
    &#125;;

    //返回编码器
    *ret_encoder = &amp;led_encoder-&gt;base;
    return ESP_OK;
err:
    if (led_encoder) &#123;
        if (led_encoder-&gt;bytes_encoder) &#123;
            rmt_del_encoder(led_encoder-&gt;bytes_encoder);
        &#125;
        if (led_encoder-&gt;copy_encoder) &#123;
            rmt_del_encoder(led_encoder-&gt;copy_encoder);
        &#125;
        free(led_encoder);
    &#125;
    return ret;
&#125;

/** 初始化WS2812外设
 * @param gpio 控制WS2812的管脚
 * @param maxled 控制WS2812的个数
 * @param led_handle 返回的控制句柄
 * @return ESP_OK or ESP_FAIL
*/
esp_err_t ws2812_init(gpio_num_t gpio,int maxled,ws2812_strip_handle_t* handle)
&#123;
    struct ws2812_strip_t* led_handle = NULL;
    //新增一个WS2812驱动描述: 1-需要分配的内存块数量；sizeof(struct ws2812_strip_t)-需要分配的内存块大小。
    led_handle = calloc(1, sizeof(struct ws2812_strip_t));
    assert(led_handle);
    //按照led个数来分配RGB缓存数据
    led_handle-&gt;led_buffer = calloc(1,maxled*3);
    assert(led_handle-&gt;led_buffer);
    //设置LED个数
    led_handle-&gt;led_num = maxled;

    //定义一个RMT发送通道配置
    rmt_tx_channel_config_t tx_chan_config = &#123;
        .clk_src = RMT_CLK_SRC_DEFAULT,         //默认时钟源
        .gpio_num = gpio,                       //GPIO管脚
        .mem_block_symbols = 64,                //内存块大小，即 64 * 4 = 256 字节
        .resolution_hz = LED_STRIP_RESOLUTION_HZ,   //RMT通道的分辨率10000000hz=0.1us，也就是可以控制的最小时间单元
        .trans_queue_depth = 4,                 //底层后台发送的队列深度
    &#125;;

    //创建一个RMT发送通道
    ESP_ERROR_CHECK(rmt_new_tx_channel(&amp;tx_chan_config, &amp;led_handle-&gt;led_chan));

    //创建自定义编码器（重点函数），所谓编码，就是发射红外时加入我们的时序控制
    ESP_ERROR_CHECK(rmt_new_led_strip_encoder(&amp;led_handle-&gt;led_encoder));

    //使能RMT通道
    ESP_ERROR_CHECK(rmt_enable(led_handle-&gt;led_chan));

    //返回WS2812操作句柄
    *handle = led_handle;

    return ESP_OK;
&#125;

/** 反初始化WS2812外设
 * @param handle 初始化的句柄
 * @return ESP_OK or ESP_FAIL
*/
esp_err_t ws2812_deinit(ws2812_strip_handle_t handle)
&#123;
    if(!handle)
        return ESP_OK;
    rmt_del_encoder(handle-&gt;led_encoder);
    if(handle-&gt;led_buffer)
        free(handle-&gt;led_buffer);
    free(handle);
    return ESP_OK;
&#125;

/** 向某个WS2812写入RGB数据
 * @param handle 句柄
 * @param index 第几个WS2812（0开始）
 * @param r,g,b RGB数据
 * @return ESP_OK or ESP_FAIL
*/
esp_err_t ws2812_write(ws2812_strip_handle_t handle,uint32_t index,uint32_t r,uint32_t g,uint32_t b)
&#123;
    // 配置RMT传输参数
    rmt_transmit_config_t tx_config = &#123;
        .loop_count = 0, // 不循环发送
    &#125;;

    // 检查索引是否超出LED数量范围
    if(index &gt;= handle-&gt;led_num)
        return ESP_FAIL; // 返回失败

    // 计算LED缓冲区的起始位置
    uint32_t start = index*3;

    // 设置LED颜色数据（注意：WS2812的数据顺序是GRB）
    handle-&gt;led_buffer[start+0] = g &amp; 0xff;     // 设置绿色分量
    handle-&gt;led_buffer[start+1] = r &amp; 0xff;     // 设置红色分量
    handle-&gt;led_buffer[start+2] = b &amp; 0xff;     // 设置蓝色分量

    // 发送LED数据
    return rmt_transmit(handle-&gt;led_chan, handle-&gt;led_encoder, handle-&gt;led_buffer, handle-&gt;led_num*3, &amp;tx_config);
    
&#125;

</code></pre>
<h2 id="led-ws2812-h"><a href="#led-ws2812-h" class="headerlink" title="led_ws2812.h"></a>led_ws2812.h</h2><pre><code class="c">/*
 * SPDX-FileCopyrightText: 2021-2022 Espressif Systems (Shanghai) CO LTD
 *
 * SPDX-License-Identifier: Apache-2.0
 */
#pragma once

#include &lt;stdint.h&gt;
#include &quot;driver/rmt_encoder.h&quot;

#ifdef __cplusplus
extern &quot;C&quot; &#123;
#endif


typedef struct ws2812_strip_t *ws2812_strip_handle_t;

/** 初始化WS2812外设
 * @param gpio 控制WS2812的管脚
 * @param maxled 控制WS2812的个数
 * @param led_handle 返回的控制句柄
 * @return ESP_OK or ESP_FAIL
*/
esp_err_t ws2812_init(gpio_num_t gpio,int maxled,ws2812_strip_handle_t* led_handle);

/** 反初始化WS2812外设
 * @param handle 初始化的句柄
 * @return ESP_OK or ESP_FAIL
*/
esp_err_t ws2812_deinit(ws2812_strip_handle_t handle);

/** 向某个WS2812写入RGB数据
 * @param handle 句柄
 * @param index 第几个WS2812（0开始）
 * @param r,g,b RGB数据
 * @return ESP_OK or ESP_FAIL
*/
esp_err_t ws2812_write(ws2812_strip_handle_t handle,uint32_t index,uint32_t r,uint32_t g,uint32_t b);


#ifdef __cplusplus
&#125;
#endif
</code></pre>
<h1 id="DHT11"><a href="#DHT11" class="headerlink" title="DHT11"></a>DHT11</h1><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p><img src="/2024/12/30/esp-idf-record/image-20241230144624134.png" alt="image-20241230144624134"></p>
<p><img src="/2024/12/30/esp-idf-record/image-20241230144724108.png" alt="image-20241230144724108"></p>
<h2 id="main-c-1"><a href="#main-c-1" class="headerlink" title="main.c"></a>main.c</h2><pre><code class="c">#include &lt;string.h&gt;
#include &lt;freertos/FreeRTOS.h&gt;
#include &lt;freertos/task.h&gt;
#include &lt;nvs_flash.h&gt;
#include &lt;driver/rmt_rx.h&gt;
#include &lt;driver/rmt_tx.h&gt;
#include &lt;soc/rmt_reg.h&gt;
#include &quot;driver/gpio.h&quot; 
#include &lt;esp_log.h&gt;
#include &lt;freertos/queue.h&gt;
#include &quot;esp32/rom/ets_sys.h&quot;

#define DHT11_GPIO    25        // DHT11引脚定义
const static char *TAG = &quot;DHT11_Demo&quot;;

// 温度是10倍，/10有1位小数
int temp_x10 = 123;
int humidity = 60;
const int channel = 0;

uint8_t DHT11_PIN = -1;

//rmt接收通道句柄
static rmt_channel_handle_t rx_chan_handle = NULL;

//数据接收队列
static QueueHandle_t rx_receive_queue = NULL;

// 将RMT读取到的脉冲数据处理为温度和湿度
static int parse_items(rmt_symbol_word_t *item, int item_num, int *humidity, int *temp_x10);

//接收完成回调函数
static bool example_rmt_rx_done_callback(rmt_channel_handle_t channel, const rmt_rx_done_event_data_t *edata, void *user_data)
&#123;
    BaseType_t high_task_wakeup = pdFALSE;
    QueueHandle_t rx_receive_queue = (QueueHandle_t)user_data;
    // send the received RMT symbols to the parser task
    xQueueSendFromISR(rx_receive_queue, edata, &amp;high_task_wakeup);
    return high_task_wakeup == pdTRUE;
&#125;

// DHT11 初始化
void DHT11_Init(uint8_t dht11_pin)
&#123;
    DHT11_PIN = dht11_pin;
    
    rmt_rx_channel_config_t rx_chan_config = &#123;
        .clk_src = RMT_CLK_SRC_DEFAULT,   // 选择时钟源
        .resolution_hz = 1000 * 1000,       // 1 MHz 滴答分辨率，即 1 滴答 = 1 µs
        .mem_block_symbols = 64,          // 内存块大小，即 64 * 4 = 256 字节
        .gpio_num = dht11_pin,            // GPIO 编号
        .flags.invert_in = false,         // 不反转输入信号
        .flags.with_dma = false,          // 不需要 DMA 后端
    &#125;;
    //创建rmt接收通道
    ESP_ERROR_CHECK(rmt_new_rx_channel(&amp;rx_chan_config, &amp;rx_chan_handle));
 
    //新建接收数据队列
    rx_receive_queue = xQueueCreate(20, sizeof(rmt_rx_done_event_data_t));
    assert(rx_receive_queue);

    //注册接收完成回调函数
     ESP_LOGI(TAG, &quot;register RX done callback&quot;);
    rmt_rx_event_callbacks_t cbs = &#123;
        .on_recv_done = example_rmt_rx_done_callback,
    &#125;;
    ESP_ERROR_CHECK(rmt_rx_register_event_callbacks(rx_chan_handle, &amp;cbs, rx_receive_queue));

    //使能RMT接收通道
    ESP_ERROR_CHECK(rmt_enable(rx_chan_handle));
&#125;

// 将RMT读取到的脉冲数据处理为温度和湿度(rmt_symbol_word_t成为RMT符号)
static int parse_items(rmt_symbol_word_t *item, int item_num, int *humidity, int *temp_x10)
&#123;
    int i = 0;
    unsigned int rh = 0, temp = 0, checksum = 0;
    if (item_num &lt; 42)&#123;                    // 检查是否有足够的脉冲数
        ESP_LOGI(TAG, &quot;item_num &lt; 42  %d&quot;,item_num);
        return 0;
    &#125;
    item++;                                // 跳过开始信号脉冲

    for (i = 0; i &lt; 16; i++, item++)    // 提取湿度数据
    &#123;
        uint16_t duration = 0;
        if(item-&gt;level0)
            duration = item-&gt;duration0;
        else
            duration = item-&gt;duration1;
        rh = (rh &lt;&lt; 1) + (duration &lt; 35 ? 0 : 1);
    &#125;


    for (i = 0; i &lt; 16; i++, item++)    // 提取温度数据
    &#123;
        uint16_t duration = 0;
        if(item-&gt;level0)
            duration = item-&gt;duration0;
        else
            duration = item-&gt;duration1;
        temp = (temp &lt;&lt; 1) + (duration &lt; 35 ? 0 : 1);
    &#125;
    
    for (i = 0; i &lt; 8; i++, item++)&#123;    // 提取校验数据
    
        uint16_t duration = 0;
        if(item-&gt;level0)
            duration = item-&gt;duration0;
        else
            duration = item-&gt;duration1;
        checksum = (checksum &lt;&lt; 1) + (duration &lt; 35 ? 0 : 1);
    &#125;
    // 检查校验
    if ((((temp &gt;&gt; 8) + temp + (rh &gt;&gt; 8) + rh) &amp; 0xFF) != checksum)&#123;
        ESP_LOGI(TAG, &quot;Checksum failure %4X %4X %2X\n&quot;, temp, rh, checksum);
        return 0;
    &#125;
    // 返回数据
    *humidity = rh &gt;&gt; 8;
    *temp_x10 = (temp &gt;&gt; 8) * 10 + (temp &amp; 0xFF);
    return 1;
&#125;


// 使用RMT接收DHT11数据
int DHT11_StartGet(int *temp_x10, int *humidity)
&#123;
    //发送20ms开始信号脉冲启动DHT11单总线
    gpio_set_direction(DHT11_PIN, GPIO_MODE_OUTPUT);
    gpio_set_level(DHT11_PIN, 1);
    ets_delay_us(1000);
    gpio_set_level(DHT11_PIN, 0);
    ets_delay_us(20000);
    //拉高20us
    gpio_set_level(DHT11_PIN, 1);
    ets_delay_us(20);
    //信号线设置为输入准备接收数据
    gpio_set_direction(DHT11_PIN, GPIO_MODE_INPUT);
    gpio_set_pull_mode(DHT11_PIN,GPIO_PULLUP_ONLY);

    //启动RMT接收器以获取数据
    rmt_receive_config_t receive_config = &#123;
        .signal_range_min_ns = 1000,     //最小脉冲宽度(1us),信号长度小于这个值，视为干扰
        .signal_range_max_ns = 200*1000,     //最大脉冲宽度(200us)，信号长度大于这个值，视为结束信号
    &#125;;
    
    static rmt_symbol_word_t raw_symbols[64];    //接收缓存
    static rmt_rx_done_event_data_t rx_data;    //实际接收到的数据
    ESP_ERROR_CHECK(rmt_receive(rx_chan_handle, raw_symbols, sizeof(raw_symbols), &amp;receive_config));

    // wait for RX done signal
    if (xQueueReceive(rx_receive_queue, &amp;rx_data, pdMS_TO_TICKS(1000)) == pdTRUE) &#123;
        // parse the receive symbols and print the result
        return parse_items(rx_data.received_symbols, rx_data.num_symbols,humidity, temp_x10);
    &#125;
    return 0;
&#125;

// 温度 湿度变量
int temp = 0,hum = 0;

// 主函数
void app_main(void)
&#123;
    ESP_ERROR_CHECK(nvs_flash_init());
    vTaskDelay(100 / portTICK_PERIOD_MS);

    ESP_LOGI(TAG, &quot;[APP] APP Is Start!~\r\n&quot;);
    ESP_LOGI(TAG, &quot;[APP] IDF Version is %d.%d.%d&quot;,ESP_IDF_VERSION_MAJOR,ESP_IDF_VERSION_MINOR,ESP_IDF_VERSION_PATCH);
    ESP_LOGI(TAG, &quot;[APP] Free memory: %lu bytes&quot;, esp_get_free_heap_size());
    ESP_LOGI(TAG, &quot;[APP] IDF version: %s&quot;, esp_get_idf_version());
    
    DHT11_Init(DHT11_GPIO);
    while (1)&#123;
        if (DHT11_StartGet(&amp;temp, &amp;hum))&#123;
            ESP_LOGI(TAG, &quot;temp-&gt;%i.%i C     hum-&gt;%i%%&quot;, temp / 10, temp % 10, hum);
        &#125;
        vTaskDelay(1000 / portTICK_PERIOD_MS);
    &#125;
&#125;
</code></pre>
<h1 id="ADC-热敏电阻"><a href="#ADC-热敏电阻" class="headerlink" title="ADC-热敏电阻"></a>ADC-热敏电阻</h1><h2 id="介绍-1"><a href="#介绍-1" class="headerlink" title="介绍"></a>介绍</h2><p><img src="/2024/12/30/esp-idf-record/image-20241230152606658.png" alt="image-20241230152606658"></p>
<p><img src="/2024/12/30/esp-idf-record/image-20241230152918154.png" alt="image-20241230152918154"></p>
<p><img src="/2024/12/30/esp-idf-record/image-20241230153126380.png" alt="image-20241230153126380"></p>
<p><img src="/2024/12/30/esp-idf-record/image-20241230153445973.png" alt="image-20241230153445973"></p>
<p><img src="/2024/12/30/esp-idf-record/image-20241230161429368.png" alt="image-20241230161429368"></p>
<h2 id="main-c-2"><a href="#main-c-2" class="headerlink" title="main.c"></a>main.c</h2><pre><code class="c">/*
 * SPDX-FileCopyrightText: 2021-2022 Espressif Systems (Shanghai) CO LTD
 *
 * SPDX-License-Identifier: Unlicense OR CC0-1.0
 */
#include &lt;string.h&gt;
#include &quot;freertos/FreeRTOS.h&quot;
#include &quot;freertos/task.h&quot;
#include &quot;esp_log.h&quot;
#include &quot;ntc.h&quot;

#define TAG     &quot;main&quot;

void app_main(void)
&#123;
    temp_ntc_init();
    while(1)
    &#123;
        ESP_LOGI(TAG,&quot;current temp:%.2f&quot;,get_temp());
        vTaskDelay(pdMS_TO_TICKS(1000));
    &#125;

&#125;
</code></pre>
<h2 id="ntc-c"><a href="#ntc-c" class="headerlink" title="ntc.c"></a>ntc.c</h2><pre><code class="c">#include &lt;string.h&gt;
#include &lt;stdio.h&gt;
#include &quot;ntc.h&quot;
#include &quot;esp_log.h&quot;
#include &quot;freertos/FreeRTOS.h&quot;
#include &quot;freertos/task.h&quot;
#include &quot;freertos/semphr.h&quot;
#include &quot;esp_adc/adc_continuous.h&quot;
#include &quot;esp_adc/adc_oneshot.h&quot;
#include &quot;esp_adc/adc_cali.h&quot;
#include &quot;esp_adc/adc_cali_scheme.h&quot;

#define TAG     &quot;adc&quot;

/*
GPIO32  ADC1_CH4
GPIO33  ADC1_CH5
GPIO34  ADC1_CH6
GPIO35  ADC1_CH7
GPIO36  ADC1_CH0
GPIO37  ADC1_CH1
GPIO38  ADC1_CH2
GPIO39  ADC1_CH3
*/
#define TEMP_ADC_CHANNEL     ADC_CHANNEL_0      //ADC转换通道(ADC1有8个通道，对应gpio32 - gpio39)

#define NTC_RES             10000               //NTC电阻标称值(在电路中和NTC一起串进电路的那个电阻,一般是10K，100K)
#define ADC_V_MAX           3300                //最大接入电压值

#define ADC_VALUE_NUM       10                  //每次采样的电压

static bool do_calibration1 = false;            //是否需要校准

static volatile float s_temp_value = 0.0f;      //室内温度



static int s_adc_raw[ADC_VALUE_NUM];              //ADC采样值
static int s_voltage_raw[ADC_VALUE_NUM];              //转换后的电压值


typedef struct
&#123;
    int8_t temp;        //温度
    uint32_t res;       //温度对应的阻值
&#125;temp_res_t;

//NTC温度表
static const temp_res_t s_ntc_table[] =
&#123;
    &#123;-10,51815&#125;,
    &#123;-9,49283&#125;,
    &#123;-8,46889&#125;,
    &#123;-7,44624&#125;,
    &#123;-6,42481&#125;,
    &#123;-5,40450&#125;,
    &#123;-4,38526&#125;,
    &#123;-3,36702&#125;,
    &#123;-2,34971&#125;,
    &#123;-1,33329&#125;,
    &#123;0,31770&#125;,
    &#123;1,30253&#125;,
    &#123;2,28815&#125;,
    &#123;3,27453&#125;,
    &#123;4,26160&#125;,
    &#123;5,24935&#125;,
    &#123;6,23772&#125;,
    &#123;7,22668&#125;,
    &#123;8,21620&#125;,
    &#123;9,20626&#125;,
    &#123;10,19681&#125;,
    &#123;11,18784&#125;,
    &#123;12,17932&#125;,
    &#123;13,17122&#125;,
    &#123;14,16353&#125;,
    &#123;15,15621&#125;,
    &#123;16,14925&#125;,
    &#123;17,14263&#125;,
    &#123;18,13634&#125;,
    &#123;19,13035&#125;,
    &#123;20,12465&#125;,
    &#123;21,11922&#125;,
    &#123;22,11406&#125;,
    &#123;23,10914&#125;,
    &#123;24,10446&#125;,
    &#123;25,10000&#125;,
    &#123;26,9574&#125;,
    &#123;27,9169&#125;,
    &#123;28,8783&#125;,
    &#123;29,8415&#125;,
    &#123;30,8064&#125;,
    &#123;31,7729&#125;,
    &#123;32,7410&#125;,
    &#123;33,7105&#125;,
    &#123;34,6814&#125;,
    &#123;35,6537&#125;,
    &#123;36,6272&#125;,
    &#123;37,6019&#125;,
    &#123;38,5778&#125;,
    &#123;39,5547&#125;,
    &#123;40,5327&#125;,
    &#123;41,5116&#125;,
    &#123;42,4915&#125;,
    &#123;43,4722&#125;,
    &#123;44,4539&#125;,
    &#123;45,4363&#125;,
    &#123;46,4195&#125;,
    &#123;47,4034&#125;,
    &#123;48,3880&#125;,
    &#123;49,3733&#125;,
    &#123;50,3592&#125;,
&#125;;

//NTC表长度
static const uint16_t s_us_ntc_table_num = sizeof(s_ntc_table)/sizeof(s_ntc_table[0]);

//ADC操作句柄
static adc_oneshot_unit_handle_t s_adc_handle = NULL;

//转换句柄
static adc_cali_handle_t adc1_cali_handle = NULL;

//NTC温度采集任务
static void temp_adc_task(void*);

static float get_ntc_temp(uint32_t res);

/*---------------------------------------------------------------
        ADC校准方案，创建校准方案后，会从官方预烧录的参数中对采集到的电压进行校准
---------------------------------------------------------------*/
static bool example_adc_calibration_init(adc_unit_t unit, adc_atten_t atten, adc_cali_handle_t *out_handle)
&#123;
    adc_cali_handle_t handle = NULL;
    esp_err_t ret = ESP_FAIL;
    bool calibrated = false;

#if ADC_CALI_SCHEME_CURVE_FITTING_SUPPORTED
    if (!calibrated) &#123;
        ESP_LOGI(TAG, &quot;calibration scheme version is %s&quot;, &quot;Curve Fitting&quot;);
        adc_cali_curve_fitting_config_t cali_config = &#123;
            .unit_id = unit,
            .atten = atten,
            .bitwidth = ADC_BITWIDTH_DEFAULT,
        &#125;;
        ret = adc_cali_create_scheme_curve_fitting(&amp;cali_config, &amp;handle);
        if (ret == ESP_OK) &#123;
            calibrated = true;
        &#125;
    &#125;
#endif

#if ADC_CALI_SCHEME_LINE_FITTING_SUPPORTED
    if (!calibrated) &#123;
        ESP_LOGI(TAG, &quot;calibration scheme version is %s&quot;, &quot;Line Fitting&quot;);
        adc_cali_line_fitting_config_t cali_config = &#123;
            .unit_id = unit,
            .atten = atten,
            .bitwidth = ADC_BITWIDTH_DEFAULT,
        &#125;;
        ret = adc_cali_create_scheme_line_fitting(&amp;cali_config, &amp;handle);
        if (ret == ESP_OK) &#123;
            calibrated = true;
        &#125;
    &#125;
#endif

    *out_handle = handle;
    if (ret == ESP_OK) &#123;
        ESP_LOGI(TAG, &quot;Calibration Success&quot;);
    &#125; else if (ret == ESP_ERR_NOT_SUPPORTED || !calibrated) &#123;
        ESP_LOGW(TAG, &quot;eFuse not burnt, skip software calibration&quot;);
    &#125; else &#123;
        ESP_LOGE(TAG, &quot;Invalid arg or no memory&quot;);
    &#125;

    return calibrated;
&#125;

/**
 * 温度检测初始化
 * @param 无
 * @return 无
*/
void temp_ntc_init(void)
&#123;
    adc_oneshot_unit_init_cfg_t init_config1 = &#123;
        .unit_id = ADC_UNIT_1,  //WIFI和ADC2无法同时启用，这里选择ADC1
    &#125;;

    //启用单次转换模式
    ESP_ERROR_CHECK(adc_oneshot_new_unit(&amp;init_config1, &amp;s_adc_handle));

    //-------------ADC1 Config---------------//
    adc_oneshot_chan_cfg_t config = &#123;
        .bitwidth = ADC_BITWIDTH_12,       //分辨率
        .atten = ADC_ATTEN_DB_12,          
        //衰减倍数，ESP32设计的ADC参考电压为1100mV,只能测量0-1100mV之间的电压，如果要测量更大范围的电压
        //需要设置衰减倍数
        /*以下是对应可测量范围
        ADC_ATTEN_DB_0        100 mV ~ 950 mV
        ADC_ATTEN_DB_2_5    100 mV ~ 1250 mV
        ADC_ATTEN_DB_6        150 mV ~ 1750 mV
        ADC_ATTEN_DB_12        150 mV ~ 2450 mV
        */
    &#125;;
    ESP_ERROR_CHECK(adc_oneshot_config_channel(s_adc_handle, TEMP_ADC_CHANNEL, &amp;config));
    //-------------ADC1 Calibration Init---------------//
    do_calibration1 = example_adc_calibration_init(ADC_UNIT_1, ADC_ATTEN_DB_12, &amp;adc1_cali_handle);

    //新建一个任务，不断地进行ADC和温度计算
    xTaskCreatePinnedToCore(temp_adc_task, &quot;adc_task&quot;, 2048, NULL,2, NULL, 1);
&#125;

/**
 * 获取温度值
 * @param 无
 * @return 温度
*/
float get_temp(void)
&#123;
    return s_temp_value;
&#125;

static void temp_adc_task(void* param)
&#123;
    uint16_t adc_cnt = 0;
    while(1)
    &#123;
        adc_oneshot_read(s_adc_handle, TEMP_ADC_CHANNEL, &amp;s_adc_raw[adc_cnt]);
        if (do_calibration1) &#123;
            adc_cali_raw_to_voltage(adc1_cali_handle, s_adc_raw[adc_cnt], &amp;s_voltage_raw[adc_cnt]);
        &#125;
        adc_cnt++;
        if(adc_cnt &gt;= 10)
        &#123;
            int i = 0;
            //用平均值进行滤波
            uint32_t voltage = 0;
            uint32_t res = 0;
            for(i = 0;i &lt; ADC_VALUE_NUM;i++)
            &#123;
                voltage += s_voltage_raw[i];
            &#125;
            voltage = voltage/ADC_VALUE_NUM;

            if(voltage &lt; ADC_V_MAX)
            &#123;
                //电压转换为相应的电阻值
                res = (voltage*NTC_RES)/(ADC_V_MAX-voltage);
                //根据电阻值查表找出对应的温度
                s_temp_value = get_ntc_temp(res);
            &#125;

            adc_cnt = 0;
        &#125;

        vTaskDelay(pdMS_TO_TICKS(100));
    &#125;
&#125;

/** 线性插值，根据一元一次方程两点式，计算出K和B值，然后将X代入方程中计算出Y值
 * 所谓的线性插值，就是已知两点的坐标，由于两点坐标比较接近，将这两点之间的连线认为是一条直线
 * 然后通过这两点计算出这条直线的k和b值，
 * 插值的意思是，有一个x值，处于x1和x2之间，想要求出对应的y值
 * 这时候可以通过刚才计算出直线方程，计算出y值
 * @param x 需要计算的X坐标
 * @param x1,x2,y1,y2 两点式坐标
 * @return y值
*/
static float linera_interpolation(int32_t x,int32_t x1, int32_t x2, int32_t y1, int32_t y2)
&#123;
    float k = (float)(y2 - y1) /(float)(x2 - x1);
    float b = (float)(x2 * y1 - x1 * y2) / (float)(x2 - x1);
    float y = k * x + b;
    return y;
&#125;

/** 二分查找，通过电阻值查找出温度值对应的下标
 * @param res 电阻值
 * @param left ntc表的左边界
 * @param right ntc表的右边界
 * @return 温度值数组下标
*/
static int find_ntc_index(uint32_t  res,uint16_t left, uint16_t right)
&#123;
    uint16_t middle = (left + right) / 2;
    if (right &lt;= left || left == middle)
    &#123;
        if (res &gt;= s_ntc_table[left].res)
            return left;
        else
            return right;
    &#125;
    if (res &gt; s_ntc_table[middle].res)
    &#123;
        right = middle;
        return find_ntc_index(res,left, right);
    &#125;
    else if (res &lt; s_ntc_table[middle].res)
    &#123;
        left = middle;
        return find_ntc_index(res,left, right);
    &#125;
    else
        return middle;
&#125;

//根据电阻值、NTC表查出对应温度
static float get_ntc_temp(uint32_t res)
&#123;
    uint16_t left = 0;
    uint16_t right = s_us_ntc_table_num - 1;
    int index = find_ntc_index(res,left,right);
    if (res == s_ntc_table[index].res)
        return s_ntc_table[index].temp;
    if (index == 0 || index == s_us_ntc_table_num - 1)
    &#123;
        return s_ntc_table[index].temp;
    &#125;
    else
    &#123;
        int next_index = index + 1;
        return linera_interpolation(res, s_ntc_table[index].res, s_ntc_table[next_index].res, 
        s_ntc_table[index].temp, s_ntc_table[next_index].temp);
    &#125;
&#125;
</code></pre>
<h2 id="ntc-h"><a href="#ntc-h" class="headerlink" title="ntc.h"></a>ntc.h</h2><pre><code class="c">#ifndef _NTC_H_
#define _NTC_H_


/**
 * 温度检测初始化
 * @param 无
 * @return 无
*/
void temp_ntc_init(void);

/**
 * 获取温度值
 * @param 无
 * @return 温度
*/
float get_temp(void);

#endif
</code></pre>
<hr>
<h1 id="HC-SR04超声波传感器"><a href="#HC-SR04超声波传感器" class="headerlink" title="HC-SR04超声波传感器"></a>HC-SR04超声波传感器</h1><h2 id="介绍-2"><a href="#介绍-2" class="headerlink" title="介绍"></a>介绍</h2><p><img src="/2024/12/30/esp-idf-record/image-20241230161725256.png" alt="image-20241230161725256"></p>
<h2 id="main-c-3"><a href="#main-c-3" class="headerlink" title="main.c"></a>main.c</h2><pre><code class="c">/*
 * SPDX-FileCopyrightText: 2021-2022 Espressif Systems (Shanghai) CO LTD
 *
 * SPDX-License-Identifier: Unlicense OR CC0-1.0
 */

#include &quot;freertos/FreeRTOS.h&quot;
#include &quot;freertos/task.h&quot;
#include &quot;esp_log.h&quot;
#include &quot;esp_private/esp_clk.h&quot;
#include &quot;driver/mcpwm_cap.h&quot;
#include &quot;driver/gpio.h&quot;

const static char *TAG = &quot;example&quot;;

//TRIG和ECHO对应的GPIO
#define HC_SR04_TRIG_GPIO  GPIO_NUM_32
#define HC_SR04_ECHO_GPIO  GPIO_NUM_33

static bool hc_sr04_echo_callback(mcpwm_cap_channel_handle_t cap_chan, const mcpwm_capture_event_data_t *edata, void *user_data)
&#123;
    static uint32_t cap_val_begin_of_sample = 0;
    static uint32_t cap_val_end_of_sample = 0;
    TaskHandle_t task_to_notify = (TaskHandle_t)user_data;
    BaseType_t high_task_wakeup = pdFALSE;

    //判断边沿，上升沿记录捕获的计数值
    if (edata-&gt;cap_edge == MCPWM_CAP_EDGE_POS) &#123;
        // store the timestamp when pos edge is detected
        cap_val_begin_of_sample = edata-&gt;cap_value;
        cap_val_end_of_sample = cap_val_begin_of_sample;
    &#125; else &#123;
        //如果是下降沿，也记录捕获的计数值
        cap_val_end_of_sample = edata-&gt;cap_value;

        //两个计数值的差值，就是脉宽长度
        uint32_t tof_ticks = cap_val_end_of_sample - cap_val_begin_of_sample;

        // 通知任务计数差值
        xTaskNotifyFromISR(task_to_notify, tof_ticks, eSetValueWithOverwrite, &amp;high_task_wakeup);
    &#125;

    return high_task_wakeup == pdTRUE;
&#125;

/**
 * @brief generate single pulse on Trig pin to start a new sample
 */
static void gen_trig_output(void)
&#123;
    gpio_set_level(HC_SR04_TRIG_GPIO, 1); // set high
    esp_rom_delay_us(10);
    gpio_set_level(HC_SR04_TRIG_GPIO, 0); // set low
&#125;

void app_main(void)
&#123;
    ESP_LOGI(TAG, &quot;Install capture timer&quot;);

    //新建一个捕获定时器，使用默认的时钟源
    mcpwm_cap_timer_handle_t cap_timer = NULL;
    mcpwm_capture_timer_config_t cap_conf = &#123;
        .clk_src = MCPWM_CAPTURE_CLK_SRC_DEFAULT,
        .group_id = 0,
    &#125;;
    ESP_ERROR_CHECK(mcpwm_new_capture_timer(&amp;cap_conf, &amp;cap_timer));

    //新建一个捕获通道，把捕获定时器与捕获通道绑定起来，采取双边捕获的策略
    ESP_LOGI(TAG, &quot;Install capture channel&quot;);
    mcpwm_cap_channel_handle_t cap_chan = NULL;
    mcpwm_capture_channel_config_t cap_ch_conf = &#123;
        .gpio_num = HC_SR04_ECHO_GPIO,
        .prescale = 1,
        // capture on both edge
        .flags.neg_edge = true,
        .flags.pos_edge = true,
        // pull up internally
        .flags.pull_up = true,
    &#125;;
    ESP_ERROR_CHECK(mcpwm_new_capture_channel(cap_timer, &amp;cap_ch_conf, &amp;cap_chan));

    //新建一个捕获事件回调函数，当捕获到相关的边沿，则调用这个回调函数
    ESP_LOGI(TAG, &quot;Register capture callback&quot;);
    TaskHandle_t cur_task = xTaskGetCurrentTaskHandle();
    mcpwm_capture_event_callbacks_t cbs = &#123;
        .on_cap = hc_sr04_echo_callback,
    &#125;;
    ESP_ERROR_CHECK(mcpwm_capture_channel_register_event_callbacks(cap_chan, &amp;cbs, cur_task));

    //使能捕获通道
    ESP_LOGI(TAG, &quot;Enable capture channel&quot;);
    ESP_ERROR_CHECK(mcpwm_capture_channel_enable(cap_chan));

    //初始化Trig引脚，设置为输出
    ESP_LOGI(TAG, &quot;Configure Trig pin&quot;);
    gpio_config_t io_conf = &#123;
        .mode = GPIO_MODE_OUTPUT,
        .pin_bit_mask = 1ULL &lt;&lt; HC_SR04_TRIG_GPIO,
    &#125;;
    ESP_ERROR_CHECK(gpio_config(&amp;io_conf));
    ESP_ERROR_CHECK(gpio_set_level(HC_SR04_TRIG_GPIO, 0));

    //使能捕获定时器
    ESP_LOGI(TAG, &quot;Enable and start capture timer&quot;);
    ESP_ERROR_CHECK(mcpwm_capture_timer_enable(cap_timer));
    ESP_ERROR_CHECK(mcpwm_capture_timer_start(cap_timer));

    uint32_t tof_ticks;
    while (1) &#123;
        //产生一个Trig
        gen_trig_output();

        // 等待捕获完成信号，
        if (xTaskNotifyWait(0x00, ULONG_MAX, &amp;tof_ticks, pdMS_TO_TICKS(1000)) == pdTRUE) &#123;
            //计算脉宽时间长度，从任务通知获取到的tof_ticks是计数，我们需要计算出对应的时间
            /*
            tof_ticks:计数
            esp_clk_apb_freq():计数时钟频率
            1/esp_clk_apb_freq():计数时钟周期，也就是1个tof_ticks时间是多少秒
            1000000/esp_clk_apb_freq():一个tof_ticks时间是多少us
            因此tof_ticks * (1000000.0 / esp_clk_apb_freq())就是总的脉宽时长
            */
            float pulse_width_us = tof_ticks * (1000000.0 / esp_clk_apb_freq());
            if (pulse_width_us &gt; 35000) &#123;
                // 脉宽太长，超出了SR04的计算范围
                continue;
            &#125;
            

            /*
            计算公式如下：
            距离D=音速V*T/2;(T是上述的脉宽时间，因为是来回时间，所以要除以2才是单程时间)
            D(单位cm)=340m/s*Tus;
            D=34000cm/s*(10^-6)Ts/2;(1us=(10^-6)s)
            D=17000*(10^-6)*T
            D=0.017*T
            D=T/58
            所以下面这个公式/58是这样来的
            */
            float distance = (float) pulse_width_us / 58;
            ESP_LOGI(TAG, &quot;Measured distance: %.2fcm&quot;, distance);
        &#125;
        vTaskDelay(pdMS_TO_TICKS(500));
    &#125;
&#125;
</code></pre>
<h1 id="SD-sdmmc"><a href="#SD-sdmmc" class="headerlink" title="SD-sdmmc"></a>SD-sdmmc</h1><h2 id="介绍-3"><a href="#介绍-3" class="headerlink" title="介绍"></a>介绍</h2><p><img src="/2024/12/30/esp-idf-record/image-20241230172625922.png" alt="image-20241230172625922"></p>
<p><img src="/2024/12/30/esp-idf-record/image-20241230173528541.png" alt="image-20241230173528541"></p>
<h2 id="main-c-4"><a href="#main-c-4" class="headerlink" title="main.c"></a>main.c</h2><pre><code class="c">/* SD card and FAT filesystem example.
   This example code is in the Public Domain (or CC0 licensed, at your option.)

   Unless required by applicable law or agreed to in writing, this
   software is distributed on an &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR
   CONDITIONS OF ANY KIND, either express or implied.
*/

// This example uses SDMMC peripheral to communicate with SD card.

#include &lt;string.h&gt;
#include &lt;sys/unistd.h&gt;
#include &lt;sys/stat.h&gt;
#include &quot;esp_vfs_fat.h&quot;
#include &quot;sdmmc_cmd.h&quot;
#include &quot;driver/sdmmc_host.h&quot;

#define EXAMPLE_MAX_CHAR_SIZE    64

static const char *TAG = &quot;example&quot;;

#define MOUNT_POINT &quot;/sdcard&quot;   //挂载点名称


/**
 * @brief 向指定路径的文件中写入数据
 *
 * 将给定的数据写入到指定路径的文件中。
 *
 * @param path 文件路径
 * @param data 要写入的数据
 *
 * @return esp_err_t 错误码，ESP_OK 表示成功，ESP_FAIL 表示失败
 */
static esp_err_t s_example_write_file(const char *path, char *data)
&#123;
    // 记录日志，表示正在打开文件
    ESP_LOGI(TAG, &quot;Opening file %s&quot;, path);
    // 以写入模式打开文件
    FILE *f = fopen(path, &quot;w&quot;);
    // 判断文件是否成功打开
    if (f == NULL) &#123;
        // 如果文件打开失败，记录错误日志
        ESP_LOGE(TAG, &quot;Failed to open file for writing&quot;);
        // 返回打开文件失败的状态
        return ESP_FAIL;
    &#125;
    // 将数据写入文件
    // fprintf(f, data);
    fputs(data, f);
    // 关闭文件
    fclose(f);
    // 记录日志，表示文件写入完成
    ESP_LOGI(TAG, &quot;File written&quot;);

    // 返回文件写入成功的状态
    return ESP_OK;
&#125;

/**
 * @brief 从指定路径读取文件内容
 *
 * 从给定的文件路径中读取一行内容，并打印出来。
 *
 * @param path 文件路径
 *
 * @return 返回 ESP_OK 表示成功，返回 ESP_FAIL 表示失败
 */
static esp_err_t s_example_read_file(const char *path)
&#123;
    // 打印读取文件的日志信息
    ESP_LOGI(TAG, &quot;Reading file %s&quot;, path);

    // 尝试以只读模式打开文件
    FILE *f = fopen(path, &quot;r&quot;);

    // 检查文件是否成功打开
    if (f == NULL) &#123;
        // 如果文件打开失败，打印错误日志并返回失败错误码
        ESP_LOGE(TAG, &quot;Failed to open file for reading&quot;);
        return ESP_FAIL;
    &#125;

    // 定义一个字符数组用于存储文件内容
    char line[EXAMPLE_MAX_CHAR_SIZE];

    // 从文件中读取一行内容
    fgets(line, sizeof(line), f);

    // 关闭文件
    fclose(f);

    // 去除换行符
    // strip newline
    char *pos = strchr(line, &#39;\n&#39;); // 用于在字符串中查找第一次出现的指定字符
    if (pos) &#123;
        *pos = &#39;\0&#39;;
    &#125;

    // 打印从文件中读取的内容
    ESP_LOGI(TAG, &quot;Read from file: &#39;%s&#39;&quot;, line);

    // 返回成功错误码
    return ESP_OK;
&#125;

void app_main(void)
&#123;
    esp_err_t ret;
    esp_vfs_fat_sdmmc_mount_config_t mount_config = &#123;
        .format_if_mount_failed = true,     //挂载失败是否执行格式化
        .max_files = 5,                     //最大可打开文件数
        .allocation_unit_size = 4 * 1024   //执行格式化时的分配单元大小（分配单元越大，读写越快）
    &#125;;
    sdmmc_card_t *card;
    const char mount_point[] = MOUNT_POINT;
    ESP_LOGI(TAG, &quot;Initializing SD card&quot;);

    ESP_LOGI(TAG, &quot;Using SDMMC peripheral&quot;);

    //默认配置，速度20MHz,使用卡槽1
    sdmmc_host_t host = SDMMC_HOST_DEFAULT();

    //默认的IO管脚配置，
    sdmmc_slot_config_t slot_config = SDMMC_SLOT_CONFIG_DEFAULT();

    //4位数据
    slot_config.width = 4;

    //管脚启用内部上拉
    slot_config.flags |= SDMMC_SLOT_FLAG_INTERNAL_PULLUP;

    ESP_LOGI(TAG, &quot;Mounting filesystem&quot;);
    ret = esp_vfs_fat_sdmmc_mount(mount_point, &amp;host, &amp;slot_config, &amp;mount_config, &amp;card);

    if (ret != ESP_OK) &#123;
        if (ret == ESP_FAIL) &#123;
            ESP_LOGE(TAG, &quot;Failed to mount filesystem. &quot;);
        &#125; else &#123;
            ESP_LOGE(TAG, &quot;Failed to initialize the card (%s). &quot;
                     &quot;Make sure SD card lines have pull-up resistors in place.&quot;, esp_err_to_name(ret));
        &#125;
        return;
    &#125;
    ESP_LOGI(TAG, &quot;Filesystem mounted&quot;);

    // Card has been initialized, print its properties
    sdmmc_card_print_info(stdout, card);

    // Use POSIX and C standard library functions to work with files:

    // First create a file.
    const char *file_hello = MOUNT_POINT&quot;/hello.txt&quot;;
    char data[EXAMPLE_MAX_CHAR_SIZE];
    snprintf(data, EXAMPLE_MAX_CHAR_SIZE, &quot;%s %s!\n&quot;, &quot;Hello&quot;, card-&gt;cid.name);
    ret = s_example_write_file(file_hello, data);
    if (ret != ESP_OK) &#123;
        return;
    &#125;

    const char *file_foo = MOUNT_POINT&quot;/foo.txt&quot;;
    // Check if destination file exists before renaming
    struct stat st;
    if (stat(file_foo, &amp;st) == 0) &#123;
        // Delete it if it exists
        unlink(file_foo);
    &#125;

    // Rename original file
    ESP_LOGI(TAG, &quot;Renaming file %s to %s&quot;, file_hello, file_foo);
    if (rename(file_hello, file_foo) != 0) &#123;
        ESP_LOGE(TAG, &quot;Rename failed&quot;);
        return;
    &#125;

    ret = s_example_read_file(file_foo);
    if (ret != ESP_OK) &#123;
        return;
    &#125;

    // Format FATFS
    #if 0
    ret = esp_vfs_fat_sdcard_format(mount_point, card);
    if (ret != ESP_OK) &#123;
        ESP_LOGE(TAG, &quot;Failed to format FATFS (%s)&quot;, esp_err_to_name(ret));
        return;
    &#125;

    if (stat(file_foo, &amp;st) == 0) &#123;
        ESP_LOGI(TAG, &quot;file still exists&quot;);
        return;
    &#125; else &#123;
        ESP_LOGI(TAG, &quot;file doesnt exist, format done&quot;);
    &#125;
    #endif
    const char *file_nihao = MOUNT_POINT&quot;/nihao.txt&quot;;
    memset(data, 0, EXAMPLE_MAX_CHAR_SIZE);
    snprintf(data, EXAMPLE_MAX_CHAR_SIZE, &quot;%s %s!\n&quot;, &quot;Nihao&quot;, card-&gt;cid.name);
    ret = s_example_write_file(file_nihao, data);
    if (ret != ESP_OK) &#123;
        return;
    &#125;

    //Open file for reading
    ret = s_example_read_file(file_nihao);
    if (ret != ESP_OK) &#123;
        return;
    &#125;

    // All done, unmount partition and disable SDMMC peripheral
    esp_vfs_fat_sdcard_unmount(mount_point, card);
    ESP_LOGI(TAG, &quot;Card unmounted&quot;);
&#125;
</code></pre>
<hr>
<h1 id="UART"><a href="#UART" class="headerlink" title="UART"></a>UART</h1><blockquote>
<p>串行通信是一种常用的数据传输方式，其中UART（通用异步收发传输器）是一种重要的串行通信协议。</p>
<h3 id="1-工作原理"><a href="#1-工作原理" class="headerlink" title="1. 工作原理"></a>1. 工作原理</h3><p>UART是一种异步串行通信协议，主要用于两个设备之间以字节（8位）为单位进行数据传输。它通过一根数据线进行发送（TX）和接收（RX），并使用起始位、数据位、校验位和停止位来框定每个数据包。</p>
<h3 id="2-数据格式"><a href="#2-数据格式" class="headerlink" title="2. 数据格式"></a>2. 数据格式</h3><p>UART通信的数据格式通常包含以下几个部分：</p>
<ul>
<li><strong>起始位</strong>：通常是1位，表示数据传输的开始。</li>
<li><strong>数据位</strong>：通常是5到9位，代表实际传输的数据。</li>
<li><strong>校验位</strong>（可选）：用于错误检测，通常是1位。</li>
<li><strong>停止位</strong>：通常是1到2位，表示数据传输的结束。</li>
</ul>
<h3 id="3-波特率"><a href="#3-波特率" class="headerlink" title="3. 波特率"></a>3. 波特率</h3><p>波特率是指每秒传输的码元数。在UART通信中，发送方和接收方的波特率必须匹配，以确保数据能够正确传输。</p>
<h3 id="4-硬件连接"><a href="#4-硬件连接" class="headerlink" title="4. 硬件连接"></a>4. 硬件连接</h3><p>UART通信通常使用两个信号线：发送线（TX）和接收线（RX）。在连接设备时，发送线应连接到接收线，反之亦然。</p>
</blockquote>
<p><img src="/2024/12/30/esp-idf-record/image-20241231094918220.png" alt="image-20241231094918220"></p>
<h2 id="GPIO交换矩阵"><a href="#GPIO交换矩阵" class="headerlink" title="GPIO交换矩阵"></a>GPIO交换矩阵</h2><blockquote>
<p>GPIO（通用输入输出，General Purpose Input/Output）交换矩阵是一种用于数字电路和微控制器的功能，允许用户灵活配置和切换GPIO引脚的功能，从而实现不同的信号连接和控制。以下是关于GPIO交换矩阵的基本知识：</p>
<h3 id="1-概念"><a href="#1-概念" class="headerlink" title="1. 概念"></a>1. 概念</h3><p>GPIO交换矩阵是一个逻辑网络，能够通过软件配置实现不同GPIO引脚的输入和输出功能。它使得同一组GPIO引脚可以根据需要被配置为不同的信号源或信号目的地。</p>
<h3 id="2-工作原理"><a href="#2-工作原理" class="headerlink" title="2. 工作原理"></a>2. 工作原理</h3><p>在一个带有GPIO交换矩阵的系统中，每个GPIO引脚可以通过控制信号与内部的其他功能模块（如外设、传感器、驱动器等）进行连接。用户可以通过编程来设置这些连接，从而实现所需的功能。例如，可以将某个引脚配置为PWM输出，而另一个引脚配置为外部中断输入。</p>
<h3 id="3-主要特点"><a href="#3-主要特点" class="headerlink" title="3. 主要特点"></a>3. 主要特点</h3><ul>
<li><strong>灵活性</strong>：允许多种功能灵活配置，适应不同应用的需求。</li>
<li><strong>节省空间</strong>：减少了物理引脚的数量需求，降低了PCB设计的复杂性。</li>
<li><strong>可编程性</strong>：用户可以通过软件轻松改变GPIO引脚的配置。</li>
</ul>
<h3 id="4-应用场景"><a href="#4-应用场景" class="headerlink" title="4. 应用场景"></a>4. 应用场景</h3><p>GPIO交换矩阵广泛应用于各种嵌入式系统、单片机、FPGA和其他数字电路设计中。常见的应用包括：</p>
<ul>
<li>外设接口的选择与控制，如传感器、显示器等。</li>
<li>不同通信协议的选择，如SPI、I2C、UART等。</li>
<li>简化电路设计，提高系统的可扩展性。</li>
</ul>
</blockquote>
<p><img src="/2024/12/30/esp-idf-record/image-20241231095400640.png" alt="image-20241231095400640"></p>
<ul>
<li>IO_MUX ：GPIO复用寄存器</li>
<li>GPIO34、35、36、39这几个引脚只能作为输入</li>
</ul>
<p><img src="/2024/12/30/esp-idf-record/image-20241231100738331.png" alt="image-20241231100738331"></p>
<h2 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h2><pre><code class="c">#include &lt;stdio.h&gt;
#include &quot;driver/uart.h&quot;
#include &quot;esp_log.h&quot;
#include &quot;driver/gpio.h&quot;

#define USER_UART UART_NUM_2
#define TAG &quot;UART_TEST&quot;

static uint8_t uart_buffer[1024];
static QueueHandle_t uart_queue;

void app_main(void)
&#123;
    uart_event_t uart_ev;
    // 初始化UART配置结构体
    uart_config_t uart_cfg = &#123;
        .baud_rate = 115200,  // 波特率设置为115200
        .data_bits = UART_DATA_8_BITS,  // 数据位设置为8位
        .parity = UART_PARITY_DISABLE,  // 禁用奇偶校验
        .stop_bits = UART_STOP_BITS_1,  // 停止位设置为1位
        .flow_ctrl = UART_HW_FLOWCTRL_DISABLE  // 禁用硬件流控
    &#125;; 

    // 应用UART配置
    uart_param_config(USER_UART, &amp;uart_cfg);
    // 设置UART引脚 32-RX, 33-TX
    uart_set_pin(USER_UART, GPIO_NUM_32, GPIO_NUM_33, -1, -1);
    // 安装UART驱动
    uart_driver_install(USER_UART, 1024, 1024, 20, &amp;uart_queue, 0);

    // 主循环
    while (1) 
    &#123;
        /* TODO: 测试UART功能 --- OK
        // 从UART读取数据
        int rec = uart_read_bytes(USER_UART, uart_buffer, 1024, pdMS_TO_TICKS(50));
        // 如果读取到数据
        if (rec) &#123;
            // 将读取到的数据写回UART
            uart_write_bytes(USER_UART, uart_buffer, rec);
        &#125;
        */

        // TODO: 测试QueueHandle_t队列句柄
        if (pdTRUE == xQueueReceive(uart_queue, &amp;uart_ev, portMAX_DELAY))
        &#123;
            switch(uart_ev.type)
            &#123;
                case UART_DATA:
                    ESP_LOGI(TAG, &quot;UART2 receive len:%i&quot;, uart_ev.size);
                    uart_read_bytes(USER_UART, uart_buffer, uart_ev.size, pdMS_TO_TICKS(1000));
                    uart_write_bytes(USER_UART, uart_buffer, uart_ev.size);
                    break;
                case UART_FIFO_OVF:
                    ESP_LOGI(TAG, &quot;UART_FIFO_OVF\n&quot;);
                    uart_flush_input(USER_UART);
                    xQueueReset(uart_queue);
                    break;
                case UART_BUFFER_FULL:
                    ESP_LOGI(TAG, &quot;UART_BUFFER_FULL\n&quot;);
                    uart_flush_input(USER_UART);
                    xQueueReset(uart_queue);
                    break;
                default:break;
            &#125;
        &#125;
    &#125;

&#125;
</code></pre>
<h1 id="SPI-ST7789-显示屏"><a href="#SPI-ST7789-显示屏" class="headerlink" title="SPI-ST7789-显示屏"></a>SPI-ST7789-显示屏</h1><h2 id="SPI介绍"><a href="#SPI介绍" class="headerlink" title="SPI介绍"></a>SPI介绍</h2><blockquote>
<p>显示-SPI接口</p>
<p>触摸-I2C接口</p>
</blockquote>
<p><img src="/2024/12/30/esp-idf-record/image-20241231110425957.png" alt="image-20241231110425957"></p>
<h2 id="SPI四种工作模式"><a href="#SPI四种工作模式" class="headerlink" title="SPI四种工作模式"></a>SPI四种工作模式</h2><blockquote>
<p>这四种模式的区别在于CLK空闲时的状态和采样的时刻。</p>
</blockquote>
<p><img src="/2024/12/30/esp-idf-record/image-20241231151544003.png" alt="image-20241231151544003"></p>
<h2 id="st7789-driver-h"><a href="#st7789-driver-h" class="headerlink" title="st7789_driver.h"></a>st7789_driver.h</h2><pre><code class="c">#ifndef _ST7789_DRIVER_H_
#define _ST7789_DRIVER_H_
#include &quot;driver/gpio.h&quot;
#include &quot;esp_err.h&quot;

typedef void(*lcd_flush_done_cb)(void* param);

typedef struct
&#123;
    gpio_num_t  mosi;       //数据
    gpio_num_t  clk;        //时钟
    gpio_num_t  cs;         //片选
    gpio_num_t  dc;         //命令
    gpio_num_t  rst;        //复位
    gpio_num_t  bl;         //背光
    uint32_t    spi_fre;    //spi总线速率
    uint16_t    width;      //宽
    uint16_t    height;     //长
    uint8_t     spin;       //选择方向(0不旋转，1顺时针旋转90, 2旋转180，3顺时针旋转270)
    lcd_flush_done_cb   done_cb;    //数据传输完成回调函数
    void*       cb_param;   //回调函数参数
&#125;st7789_cfg_t;


/** st7789初始化
 * @param st7789_cfg_t  接口参数
 * @return 成功或失败
*/
esp_err_t st7789_driver_hw_init(st7789_cfg_t* cfg);

/** st7789写入显示数据
 * @param x1,x2,y1,y2:显示区域
 * @return 无
*/
void st7789_flush(int x1,int x2,int y1,int y2,void *data);

/** 控制背光
 * @param enable 是否使能背光
 * @return 无
*/
void st7789_lcd_backlight(bool enable);

#endif
</code></pre>
<h2 id="st7789-driver-c"><a href="#st7789-driver-c" class="headerlink" title="st7789_driver.c"></a>st7789_driver.c</h2><pre><code class="c">#include &quot;freertos/FreeRTOS.h&quot;
#include &quot;freertos/task.h&quot;
#include &quot;esp_timer.h&quot;
#include &quot;esp_lcd_panel_io.h&quot;
#include &quot;esp_lcd_panel_vendor.h&quot;
#include &quot;esp_lcd_panel_ops.h&quot;
#include &quot;esp_lcd_panel_commands.h&quot;
#include &quot;driver/gpio.h&quot;
#include &quot;driver/spi_master.h&quot;
#include &quot;esp_err.h&quot;
#include &quot;esp_log.h&quot;
#include &quot;st7789_driver.h&quot;
#include &quot;lvgl/lvgl.h&quot;

#define LCD_SPI_HOST    SPI2_HOST

static const char* TAG = &quot;st7789&quot;;

//lcd操作句柄
static esp_lcd_panel_io_handle_t lcd_io_handle = NULL;

//刷新完成回调函数
static lcd_flush_done_cb    s_flush_done_cb = NULL;

//背光GPIO
static gpio_num_t   s_bl_gpio = -1;

/**
 * @brief 通知刷新准备完成的回调函数
 *
 * 当LCD刷新准备完成时，该函数将被调用。
 *
 * @param panel_io LCD面板IO句柄
 * @param edata 事件数据指针
 * @param user_ctx 用户上下文指针
 *
 * @return 如果函数执行成功，则返回false；否则返回true
 */
static bool notify_flush_ready(esp_lcd_panel_io_handle_t panel_io, esp_lcd_panel_io_event_data_t *edata, void *user_ctx)
&#123;
    // 如果存在刷新完成回调函数
    if(s_flush_done_cb)
        // 调用刷新完成回调函数
        s_flush_done_cb(user_ctx);
    // 返回false
    return false;
&#125;

/**
 * @brief 初始化ST7789驱动硬件
 *
 * 此函数用于初始化ST7789液晶显示器的硬件部分，包括SPI总线、GPIO配置、LCD操作句柄的创建以及LCD的初始化命令发送。
 *
 * @param cfg 指向st7789_cfg_t结构的指针，包含初始化所需的配置信息
 *
 * @return esp_err_t 返回操作结果，成功返回ESP_OK，失败返回相应的错误码
 */
esp_err_t st7789_driver_hw_init(st7789_cfg_t* cfg)
&#123;
    // 初始化SPI总线配置
    spi_bus_config_t buscfg = &#123;
        .sclk_io_num = cfg-&gt;clk,        // 设置SPI时钟引脚
        .mosi_io_num = cfg-&gt;mosi,       // 设置数据输出引脚
        .miso_io_num = -1,              // 只写入不读取，所以此引脚不使用
        .quadwp_io_num = -1,            // 不使用四线模式的写保护引脚
        .quadhd_io_num = -1,            // 不使用四线模式的读保护引脚
        .flags = SPICOMMON_BUSFLAG_MASTER, // 设置SPI为主模式
        .max_transfer_sz = cfg-&gt;width * 40 * sizeof(uint16_t), // 最大DMA传输字节数，根据LCD分辨率和色深计算
    &#125;;
    
    // 初始化SPI总线，检查返回值以确保初始化成功
    ESP_ERROR_CHECK(spi_bus_initialize(LCD_SPI_HOST, &amp;buscfg, SPI_DMA_CH_AUTO));

    // 设置刷新完成的回调函数
    s_flush_done_cb = cfg-&gt;done_cb; 

    // 设置背光GPIO引脚
    s_bl_gpio = cfg-&gt;bl;    
    // 配置背光控制GPIO
    gpio_config_t bl_gpio_cfg = &#123;
        .pull_up_en = GPIO_PULLUP_DISABLE,          // 禁止上拉电阻
        .pull_down_en = GPIO_PULLDOWN_DISABLE,      // 禁止下拉电阻
        .mode = GPIO_MODE_OUTPUT,                   // 设置为输出模式
        .intr_type = GPIO_INTR_DISABLE,             // 禁用GPIO中断
        .pin_bit_mask = (1 &lt;&lt; cfg-&gt;bl)              // 指定背光控制的GPIO引脚
    &#125;;
    // 应用GPIO配置
    gpio_config(&amp;bl_gpio_cfg);

    // 如果复位脚有效，则进行GPIO配置
    if (cfg-&gt;rst &gt; 0) &#123;
        gpio_config_t rst_gpio_cfg = &#123;
            .pull_up_en = GPIO_PULLUP_DISABLE,          // 禁止上拉电阻
            .pull_down_en = GPIO_PULLDOWN_DISABLE,      // 禁止下拉电阻
            .mode = GPIO_MODE_OUTPUT,                   // 设置为输出模式
            .intr_type = GPIO_INTR_DISABLE,             // 禁用GPIO中断
            .pin_bit_mask = (1 &lt;&lt; cfg-&gt;rst)             // 指定复位控制的GPIO引脚
        &#125;;
        // 应用复位引脚的GPIO配置
        gpio_config(&amp;rst_gpio_cfg);
    &#125;

    // 创建基于SPI的LCD操作句柄
    esp_lcd_panel_io_spi_config_t io_config = &#123;
        .dc_gpio_num = cfg-&gt;dc,                     // 数据/命令选择引脚，DC引脚设置
        .cs_gpio_num = cfg-&gt;cs,                     // 片选引脚
        .pclk_hz = cfg-&gt;spi_fre,                    // 设置SPI时钟频率
        .lcd_cmd_bits = 8,                          // 设置LCD命令的位宽
        .lcd_param_bits = 8,                        // 设置LCD参数的位宽
        .spi_mode = 0,                              // 使用SPI模式0
        .trans_queue_depth = 10,                    // 设置SPI传输事务队列深度
        .on_color_trans_done = notify_flush_ready,   // 刷新完成的回调函数
        .user_ctx = cfg-&gt;cb_param,                  // 回调函数的参数
        .flags = &#123;                                  // SPI时序相关参数
            .sio_mode = 0,                          // 通过一根数据线（MOSI）读写数据
        &#125;,
    &#125;;

    // 将LCD连接到SPI总线，并检查返回值以确保成功
    ESP_LOGI(TAG, &quot;create esp_lcd_new_panel&quot;);
    ESP_ERROR_CHECK(esp_lcd_new_panel_io_spi((esp_lcd_spi_bus_handle_t)LCD_SPI_HOST, &amp;io_config, &amp;lcd_io_handle));
    
    // 如果复位引脚有效，执行硬件复位操作
    if (cfg-&gt;rst &gt; 0) &#123;
        gpio_set_level(cfg-&gt;rst, 0);              // 拉低复位引脚
        vTaskDelay(pdMS_TO_TICKS(20));            // 延时20毫秒以确保复位
        gpio_set_level(cfg-&gt;rst, 1);              // 拉高复位引脚
        vTaskDelay(pdMS_TO_TICKS(20));            // 延时20毫秒以确保复位完成
    &#125;

    // 向LCD写入初始化命令
    esp_lcd_panel_io_tx_param(lcd_io_handle, LCD_CMD_SWRESET, NULL, 0); // 发送软件复位命令
    vTaskDelay(pdMS_TO_TICKS(150));              // 延时150毫秒等待复位完成
    esp_lcd_panel_io_tx_param(lcd_io_handle, LCD_CMD_SLPOUT, NULL, 0);  // 发送退出休眠命令
    vTaskDelay(pdMS_TO_TICKS(200));              // 延时200毫秒等待退出休眠完成
    esp_lcd_panel_io_tx_param(lcd_io_handle, LCD_CMD_COLMOD, (uint8_t[]) &#123;0x55,&#125;, 1); // 设置RGB颜色格式，0x55表示RGB565
    esp_lcd_panel_io_tx_param(lcd_io_handle, 0xb0, (uint8_t[]) &#123;0x00, 0xF0&#125;, 2); // 设置其他参数

    esp_lcd_panel_io_tx_param(lcd_io_handle, LCD_CMD_INVON, NULL, 0);   // 发送颜色翻转命令
    esp_lcd_panel_io_tx_param(lcd_io_handle, LCD_CMD_NORON, NULL, 0);   // 发送普通显示模式命令
    uint8_t spin_type = 0; // 初始化旋转类型
    switch (cfg-&gt;spin) &#123;
        case 0:
            spin_type = 0x00;   // 不旋转
            break;
        case 1:
            spin_type = 0x60;   // 顺时针旋转90度
            break;
        case 2:
            spin_type = 0xC0;   // 旋转180度
            break;
        case 3:
            spin_type = 0xA0;   // 顺时针旋转270度（逆时针旋转90度）
            break;
        default:
            break; // 处理未知旋转类型
    &#125;
    esp_lcd_panel_io_tx_param(lcd_io_handle, LCD_CMD_MADCTL, (uint8_t[]) &#123;spin_type,&#125;, 1); // 设置屏幕旋转方向
    vTaskDelay(pdMS_TO_TICKS(150));              // 延时150毫秒等待配置完成
    esp_lcd_panel_io_tx_param(lcd_io_handle, LCD_CMD_DISPON, NULL, 0); // 发送显示打开命令
    vTaskDelay(pdMS_TO_TICKS(300));              // 延时300毫秒等待显示打开完成

    return ESP_OK; // 返回成功状态
&#125;

/**
 * @brief 刷新ST7789显示屏幕指定区域的函数
 *
 * 该函数用于将指定区域的像素数据写入ST7789显示屏。
 *
 * @param x1 刷新区域的左上角x坐标
 * @param x2 刷新区域的右下角x坐标
 * @param y1 刷新区域的左上角y坐标
 * @param y2 刷新区域的右下角y坐标
 * @param data 指向包含像素数据的缓冲区的指针
 */
void st7789_flush(int x1,int x2,int y1,int y2,void *data)
&#123;
    // 定义MCU可以访问的帧内存区域
    if(x2 &lt;= x1 || y2 &lt;= y1)
    &#123;
        // 如果坐标不合法，调用回调函数并返回
        if(s_flush_done_cb)
            s_flush_done_cb(NULL);
        return;
    &#125;

    // 设置列地址集
    esp_lcd_panel_io_tx_param(lcd_io_handle, LCD_CMD_CASET, (uint8_t[]) &#123;
        (x1 &gt;&gt; 8) &amp; 0xFF,
        x1 &amp; 0xFF,
        ((x2 - 1) &gt;&gt; 8) &amp; 0xFF,
        (x2 - 1) &amp; 0xFF,
    &#125;, 4);

    // 设置行地址集
    esp_lcd_panel_io_tx_param(lcd_io_handle, LCD_CMD_RASET, (uint8_t[]) &#123;
        (y1 &gt;&gt; 8) &amp; 0xFF,
        y1 &amp; 0xFF,
        ((y2 - 1) &gt;&gt; 8) &amp; 0xFF,
        (y2 - 1) &amp; 0xFF,
    &#125;, 4);

    // 传输帧缓冲区
    // transfer frame buffer
    size_t len = (x2 - x1) * (y2 - y1) * 2;
    esp_lcd_panel_io_tx_color(lcd_io_handle, LCD_CMD_RAMWR, data, len);
    return ;
&#125;

/** 控制背光
 * @param enable 是否使能背光
 * @return 无
*/
void st7789_lcd_backlight(bool enable)
&#123;
    if(enable)
    &#123;
        gpio_set_level(s_bl_gpio,1);
    &#125;
    else
    &#123;
        gpio_set_level(s_bl_gpio,0);
    &#125;
&#125;
</code></pre>
<h2 id="main-c-5"><a href="#main-c-5" class="headerlink" title="main.c"></a>main.c</h2><pre><code class="c">#include &lt;string.h&gt;
#include &lt;freertos/FreeRTOS.h&gt;
#include &lt;freertos/task.h&gt;
#include &quot;lv_port.h&quot;
#include &quot;lvgl.h&quot;
#include &quot;lv_demos.h&quot;
#include &quot;st7789_driver.h&quot;

// 主函数
void app_main(void)
&#123;
    lv_port_init();                 //初始化LVGL
    lv_demo_widgets();              //初始化控件demo程序
    //lv_demo_stress();
    st7789_lcd_backlight(true);         //打开背光
    while(1)
    &#123;
        vTaskDelay(pdMS_TO_TICKS(10));
        lv_task_handler();          //LVGL循环处理
    &#125;
&#125;
</code></pre>
<hr>
<h1 id="I2C-CST816T-触摸屏"><a href="#I2C-CST816T-触摸屏" class="headerlink" title="I2C-CST816T-触摸屏"></a>I2C-CST816T-触摸屏</h1><h2 id="I2C介绍"><a href="#I2C介绍" class="headerlink" title="I2C介绍"></a>I2C介绍</h2><blockquote>
<p>目前大多数触摸屏采用的是I2C总线，电容触摸方式。</p>
</blockquote>
<p><img src="/2024/12/30/esp-idf-record/image-20241231172333024.png" alt="image-20241231172333024"></p>
<p><img src="/2024/12/30/esp-idf-record/image-20250102163028477.png" alt="image-20250102163028477"></p>
<h2 id="cst816t-h"><a href="#cst816t-h" class="headerlink" title="cst816t.h"></a>cst816t.h</h2><pre><code class="c">#ifndef _CST816T_DRIVER_H_
#define _CST816T_DRIVER_H_
#include &quot;driver/gpio.h&quot;
#include &quot;esp_err.h&quot;


//CST816T 触摸IC驱动

typedef struct 
&#123;
    gpio_num_t  scl;     //SCL管脚
    gpio_num_t  sda;     //SDA管脚
    uint32_t    fre;       //I2C速率
    uint16_t    x_limit;    //X方向触摸边界
    uint16_t    y_limit;    //y方向触摸边界
&#125;cst816t_cfg_t;


/** CST816T初始化
 * @param cfg 配置
 * @return err
*/
esp_err_t   cst816t_init(cst816t_cfg_t* cfg);

/** 读取坐标值
 * @param  x x坐标
 * @param  y y坐标
 * @param state 松手状态 0,松手 1按下
 * @return 无
*/
void cst816t_read(int16_t *x,int16_t *y,int *state);

#endif
</code></pre>
<h2 id="cst816t-c"><a href="#cst816t-c" class="headerlink" title="cst816t.c"></a>cst816t.c</h2><pre><code class="c">#include &quot;cst816t_driver.h&quot;
#include &quot;driver/i2c.h&quot;
//#include &quot;driver/i2c_master.h&quot;
#include &quot;esp_log.h&quot;

#define TOUCH_I2C_PORT      I2C_NUM_0

#define CST816T_ADDR    0x15

static const char *TAG = &quot;cst816t&quot;;

//边界值
static uint16_t s_usLimitX = 0;
static uint16_t s_usLimitY = 0;

static esp_err_t i2c_read(uint8_t slave_addr, uint8_t register_addr, uint8_t read_len,uint8_t *data_buf);

/** CST816T初始化
 * @param cfg 配置
 * @return err
*/
esp_err_t   cst816t_init(cst816t_cfg_t* cfg)
&#123;
    int i2c_master_port = TOUCH_I2C_PORT;
    i2c_config_t conf = &#123;
        .mode               = I2C_MODE_MASTER,
        .sda_io_num         = cfg-&gt;sda,
        .sda_pullup_en      = GPIO_PULLUP_ENABLE,
        .scl_io_num         = cfg-&gt;scl,
        .scl_pullup_en      = GPIO_PULLUP_ENABLE,
        .master.clk_speed   = cfg-&gt;fre,
    &#125;;
    s_usLimitX = cfg-&gt;x_limit;
    s_usLimitY = cfg-&gt;y_limit;
    ESP_ERROR_CHECK(i2c_param_config(i2c_master_port, &amp;conf));
    ESP_ERROR_CHECK(i2c_driver_install(i2c_master_port, conf.mode, 0, 0, 0));
    
    uint8_t data_buf;
    i2c_read(CST816T_ADDR, 0xA7, 1,&amp;data_buf);
    ESP_LOGI(TAG, &quot;\tChip ID: 0x%02x&quot;, data_buf);

    i2c_read(CST816T_ADDR, 0xA9, 1,&amp;data_buf);
    ESP_LOGI(TAG, &quot;\tFirmware version: 0x%02x&quot;, data_buf);

    i2c_read(CST816T_ADDR, 0xAA, 1,&amp;data_buf);
    ESP_LOGI(TAG, &quot;\tFactory ID: 0x%02x&quot;, data_buf);

    return ESP_OK;
&#125;

/** 读取坐标值
 * @param  x x坐标
 * @param  y y坐标
 * @param state 松手状态 0,松手 1按下
 * @return 无
*/
void cst816t_read(int16_t *x,int16_t *y,int *state)
&#123;
    uint8_t data_x[2];        // 2 bytesX
    uint8_t data_y[2];        // 2 bytesY
    uint8_t touch_pnt_cnt = 0;        // Number of detected touch points
    static int16_t last_x = 0;  // 12bit pixel value
    static int16_t last_y = 0;  // 12bit pixel value
    i2c_read(CST816T_ADDR, 0x02,1, &amp;touch_pnt_cnt);
    if (touch_pnt_cnt != 1) &#123;    // ignore no touch &amp; multi touch
        *x = last_x;
        *y = last_y;
        *state = 0;
        return;
    &#125;

    //读取X坐标
    i2c_read(CST816T_ADDR,0x03,2,data_x);

    //读取Y坐标
    i2c_read(CST816T_ADDR,0x05,2,data_y);

    int16_t current_x = ((data_x[0] &amp; 0x0F) &lt;&lt; 8) | (data_x[1] &amp; 0xFF);
    int16_t current_y = ((data_y[0] &amp; 0x0F) &lt;&lt; 8) | (data_y[1] &amp; 0xFF);

    if(last_x != current_x || current_y != last_y)
    &#123;
        last_x = current_x;
        last_y = current_y;
        //ESP_LOGI(TAG,&quot;touch x:%d,y:%d&quot;,last_x,last_y);
    &#125;


    if(last_x &gt;= s_usLimitX)
        last_x = s_usLimitX - 1;
    if(last_y &gt;= s_usLimitY)
        last_y = s_usLimitY - 1;

    *x = last_x;
    *y = last_y;
    *state = 1;
&#125;




/** 根据寄存器地址读取N字节
 * @param slave_addr 器件地址
 * @param register_addr 寄存器地址
 * @param read_len  要读取的数据长度
 * @param data_buf 数据
 * @return err
*/
static esp_err_t i2c_read(uint8_t slave_addr, uint8_t register_addr, uint8_t read_len,uint8_t *data_buf) 
&#123;
    i2c_cmd_handle_t i2c_cmd = i2c_cmd_link_create();
    if(!i2c_cmd)
    &#123;
        ESP_LOGE(TAG, &quot;Error i2c_cmd creat fail!&quot;);
        return ESP_FAIL;
    &#125;
    i2c_master_start(i2c_cmd);
    i2c_master_write_byte(i2c_cmd, (slave_addr &lt;&lt; 1) | I2C_MASTER_WRITE, true);
    i2c_master_write_byte(i2c_cmd, register_addr, I2C_MASTER_ACK);

    i2c_master_start(i2c_cmd);
    i2c_master_write_byte(i2c_cmd, (slave_addr &lt;&lt; 1) | I2C_MASTER_READ, true);
    for(int i = 0;i &lt; read_len;i++)
    &#123;
        if(i == read_len - 1)
            i2c_master_read_byte(i2c_cmd, &amp;data_buf[i], I2C_MASTER_NACK);
        else
            i2c_master_read_byte(i2c_cmd, &amp;data_buf[i], I2C_MASTER_ACK);
    &#125;
    i2c_master_stop(i2c_cmd);
    esp_err_t ret = i2c_master_cmd_begin(TOUCH_I2C_PORT, i2c_cmd, pdMS_TO_TICKS(1000));
    i2c_cmd_link_delete(i2c_cmd);
    return ret;
&#125;
</code></pre>
<h2 id="main-c-6"><a href="#main-c-6" class="headerlink" title="main.c"></a>main.c</h2><pre><code class="c">#include &lt;string.h&gt;
#include &lt;freertos/FreeRTOS.h&gt;
#include &lt;freertos/task.h&gt;
#include &quot;lv_port.h&quot;
#include &quot;lvgl.h&quot;
#include &quot;lv_demos.h&quot;
#include &quot;st7789_driver.h&quot;

// 主函数
void app_main(void)
&#123;
    lv_port_init();                 //初始化LVGL
    lv_demo_widgets();              //初始化控件demo程序
    //lv_demo_stress();
    st7789_lcd_backlight(true);         //打开背光
    while(1)
    &#123;
        vTaskDelay(pdMS_TO_TICKS(10));
        lv_task_handler();          //LVGL循环处理
    &#125;
&#125;
</code></pre>
<hr>
<h1 id="LVGL"><a href="#LVGL" class="headerlink" title="LVGL"></a>LVGL</h1><h2 id="组件介绍"><a href="#组件介绍" class="headerlink" title="组件介绍"></a>组件介绍</h2><blockquote>
<p>组件是一个模块化的代码功能，一般用于实现特定的功能。</p>
<p>main是一个特殊的组件，默认可以使用ESP-IDF的所有组件，不需要在CMakeList.txt中声明对其它组件的依赖。</p>
</blockquote>
<pre><code class="txt"># For more information about build system see
# https://docs.espressif.com/projects/esp-idf/en/latest/api-guides/build-system.html
# The following five lines of boilerplate have to be in your project&#39;s
# CMakeLists in this exact order for cmake to work correctly
cmake_minimum_required(VERSION 3.16)

include($ENV&#123;IDF_PATH&#125;/tools/cmake/project.cmake)
project(lvgl_display)

set(EXTRA_COMPONENT_DIRS ./components)
</code></pre>
<h2 id="添加组件"><a href="#添加组件" class="headerlink" title="添加组件"></a>添加组件</h2><p>方式一：从乐鑫的组件管理服务器上下载，并以组件的形式加入到自己的项目工程中。</p>
<pre><code class="sh">idf.py add-dependency &quot;lvgl/lvgl^8.3.10&quot;
</code></pre>
<p>方式二：从github下载 【具体过程见下图】</p>
<pre><code class="sh">git clone --recursive https://github.com/lvgl/lvgl
</code></pre>
<p><img src="/2024/12/30/esp-idf-record/image-20241231145719432.png" alt="image-20241231145719432"></p>
<h2 id="切换版本"><a href="#切换版本" class="headerlink" title="切换版本"></a>切换版本</h2><pre><code class="sh">cd lvgl/
git tag
git checkout v8.3.10
</code></pre>
<h2 id="lv-port-c"><a href="#lv-port-c" class="headerlink" title="lv_port.c"></a>lv_port.c</h2><pre><code class="c">#include &quot;freertos/FreeRTOS.h&quot;
#include &quot;freertos/task.h&quot;
#include &quot;lvgl.h&quot;
#include &quot;esp_log.h&quot;
#include &quot;st7789_driver.h&quot;
#include &quot;cst816t_driver.h&quot;
#include &quot;driver/gpio.h&quot;
#include &quot;esp_timer.h&quot;

/*
1.初始化和注册LVGL显示驱动
2.初始化和注册LVGL触摸驱动
3.初始化ST7789硬件接口
4.初始化CST816T硬件接口
5.提供一个定时器给LVGL使用
*/

#define TAG     &quot;lv_port&quot;

#define LCD_WIDTH       240
#define LCD_HEIGHT      280

static lv_disp_drv_t    disp_drv;

void lv_flush_done_cb(void* param)
&#123;
    lv_disp_flush_ready(&amp;disp_drv);
&#125;

void disp_flush(struct _lv_disp_drv_t * disp_drv, const lv_area_t * area, lv_color_t * color_p)
&#123;
    st7789_flush(area-&gt;x1,area-&gt;x2 + 1,area-&gt;y1+20,area-&gt;y2+20 + 1,color_p);
&#125;

void lv_disp_init(void)
&#123;
    static lv_disp_draw_buf_t   disp_buf;
    const size_t disp_buf_size = LCD_WIDTH*(LCD_HEIGHT/7);

    lv_color_t *disp1 = heap_caps_malloc(disp_buf_size*sizeof(lv_color_t),MALLOC_CAP_INTERNAL|MALLOC_CAP_DMA);
    lv_color_t *disp2 = heap_caps_malloc(disp_buf_size*sizeof(lv_color_t),MALLOC_CAP_INTERNAL|MALLOC_CAP_DMA);
    if(!disp1 || !disp2)
    &#123;
        ESP_LOGE(TAG,&quot;disp buff malloc fail!&quot;);
        return;
    &#125;
    lv_disp_draw_buf_init(&amp;disp_buf,disp1,disp2,disp_buf_size);

    lv_disp_drv_init(&amp;disp_drv);

    disp_drv.hor_res = LCD_WIDTH;
    disp_drv.ver_res = LCD_HEIGHT;
    disp_drv.draw_buf = &amp;disp_buf;
    disp_drv.flush_cb = disp_flush;
    lv_disp_drv_register(&amp;disp_drv);
&#125;

void IRAM_ATTR indev_read(struct _lv_indev_drv_t * indev_drv, lv_indev_data_t * data)
&#123;
    int16_t x,y;
    int state;
    cst816t_read(&amp;x,&amp;y,&amp;state);
    data-&gt;point.x = x;
    data-&gt;point.y = y;
    data-&gt;state = state;
&#125;

void lv_indev_init(void)
&#123;
    static lv_indev_drv_t indev_drv;
    lv_indev_drv_init(&amp;indev_drv);
    indev_drv.type = LV_INDEV_TYPE_POINTER;
    indev_drv.read_cb = indev_read;
    lv_indev_drv_register(&amp;indev_drv);
&#125;

void st7789_hw_init(void)
&#123;
    st7789_cfg_t st7789_config = &#123;
        .bl = GPIO_NUM_26,
        .clk = GPIO_NUM_18,
        .cs = GPIO_NUM_5,
        .dc = GPIO_NUM_17,
        .mosi = GPIO_NUM_19,
        .rst = GPIO_NUM_21,
        .spi_fre = 40*1000*1000,
        .height = LCD_HEIGHT,
        .width = LCD_WIDTH,
        .spin = 0,
        .done_cb = lv_flush_done_cb,
        .cb_param = &amp;disp_drv,
    &#125;;

    st7789_driver_hw_init(&amp;st7789_config);
&#125;

void cst816t_hw_init(void)
&#123;
    cst816t_cfg_t cst816t_config = 
    &#123;
        .scl = GPIO_NUM_22,
        .sda = GPIO_NUM_23,
        .fre = 300*1000,
        .x_limit = LCD_WIDTH,
        .y_limit = LCD_HEIGHT,
    &#125;;
    cst816t_init(&amp;cst816t_config);
&#125;

void lv_timer_cb(void* arg)
&#123;
    uint32_t tick_interval = *((uint32_t*)arg);
    lv_tick_inc(tick_interval);
&#125;

void lv_tick_init(void)
&#123;
    static uint32_t tick_interval = 5;
    const esp_timer_create_args_t arg = 
    &#123;
        .arg = &amp;tick_interval,
        .callback = lv_timer_cb,
        .name = &quot;&quot;,
        .dispatch_method = ESP_TIMER_TASK,
        .skip_unhandled_events = true,
    &#125;;

    esp_timer_handle_t timer_handle;
    esp_timer_create(&amp;arg,&amp;timer_handle);
    esp_timer_start_periodic(timer_handle,tick_interval*1000);
&#125;

void lv_port_init(void)
&#123;
    lv_init();
    st7789_hw_init();
    cst816t_hw_init();
    lv_disp_init();
    lv_indev_init();
    lv_tick_init();
&#125;
</code></pre>

      
       <hr><span style="font-style: italic;color: gray;"> 转载请注明来源，欢迎对文章中的引用来源进行考证，欢迎指出任何有错误或不够清晰的表达。可以在下面评论区评论，也可以邮件至 jungle8884@163.com </span>
    </div>
</article>


<p>
    <a  class="dashang" onclick="dashangToggle()">赏</a>
</p>




    <div id="comments"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">

<script type="text/javascript">
    $.getScript('/js/gitalk.js', function () {
        var gitalk = new Gitalk({
            clientID: 'Ov23liadDA3bjzC5ilQK',
            clientSecret: '76701874b25b73480a0b34c298c47a442a189808',
            repo: 'jungle8884.github.io',
            owner: 'jungle8884',
            admin: ['jungle8884'],
            id: decodeURI(location.pathname),
            distractionFreeMode: 'true',
            language: 'zh-CN',
            perPage: parseInt('10',10)
        })
        gitalk.render('comments')
    })
</script>




    




    </div>
    <div class="copyright">
        <p class="footer-entry">
    ©2019-2022 Jungle
</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full" data-title="切换全屏 快捷键 s"><span class="min "></span></button>
<a class="" id="rocket" ></a>

    </div>
</div>

<div class="hide_box" onclick="dashangToggle()"></div>
<div class="shang_box">
    <a class="shang_close"  onclick="dashangToggle()">×</a>
    <div class="shang_tit">
        <p>喜欢就点赞,疼爱就打赏</p>
    </div>
    <div class="shang_payimg">
        <div class="pay_img">
            <img src="/img/alipay.jpg" class="alipay" title="扫码支持">
            <img src="/img/weixin.jpg" class="weixin" title="扫码支持">
        </div>
    </div>
    <div class="shang_payselect">
        <span><label><input type="radio" name="pay" checked value="alipay">支付宝</label></span><span><label><input type="radio" name="pay" value="weixin">微信</label></span>
    </div>
</div>


</body>
<script src="/js/jquery.pjax.js?v=1.1.0" ></script>

<script src="/js/script.js?v=1.1.0" ></script>
<script>
    var img_resize = 'default';
    function initArticle() {
        /*渲染对应的表格样式*/
        
            $("#post .pjax table").addClass("green_title");
        

        /*渲染打赏样式*/
        
        $("input[name=pay]").on("click", function () {
            if($("input[name=pay]:checked").val()=="weixin"){
                $(".shang_box .shang_payimg .pay_img").addClass("weixin_img");
            } else {
                $(".shang_box .shang_payimg .pay_img").removeClass("weixin_img");
            }
        })
        

        /*高亮代码块行号*/
        

        /*访问数量*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*代码高亮，行号对齐*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
        
    }

    /*打赏页面隐藏与展示*/
    
    function dashangToggle() {
        $(".shang_box").fadeToggle();
        $(".hide_box").fadeToggle();
    }
    

</script>

<!--加入行号的高亮代码块样式-->

<!--自定义样式设置-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*列表样式*/
    

    /* 背景图样式 */
    
    


    /*引用块样式*/
    

    /*文章列表背景图*/
    

    
</style>







</html>
